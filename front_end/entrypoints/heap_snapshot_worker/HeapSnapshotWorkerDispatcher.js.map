{"version":3,"file":"HeapSnapshotWorkerDispatcher.js","sourceRoot":"","sources":["../../../../../../front_end/entrypoints/heap_snapshot_worker/HeapSnapshotWorkerDispatcher.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2011 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport type * as HeapSnapshotModel from '../../models/heap_snapshot_model/heap_snapshot_model.js';\ninterface DispatcherResponse {\n  callId?: number;\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  result: any;\n  error?: string;\n  errorCallStack?: Object;\n  errorMethodName?: string;\n}\nexport class HeapSnapshotWorkerDispatcher {\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private objects: any[];\n  private readonly global: Worker;\n  private readonly postMessage: Function;\n  constructor(globalObject: Worker, postMessage: Function) {\n    this.objects = [];\n    this.global = globalObject;\n    this.postMessage = postMessage;\n  }\n\n  private findFunction(name: string): Function {\n    const path = name.split('.');\n    // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let result = (this.global as any);\n    for (let i = 0; i < path.length; ++i) {\n      result = result[path[i]];\n    }\n    return /** @type {!Function} */ result as Function;\n  }\n\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  sendEvent(name: string, data: any): void {\n    this.postMessage({eventName: name, data: data});\n  }\n\n  dispatchMessage({data}: {data: HeapSnapshotModel.HeapSnapshotModel.WorkerCommand}): void {\n    const response: DispatcherResponse =\n        {callId: data.callId, result: null, error: undefined, errorCallStack: undefined, errorMethodName: undefined};\n    try {\n      switch (data.disposition) {\n        case 'create': {\n          const constructorFunction = this.findFunction(data.methodName);\n          // @ts-ignore\n          this.objects[data.objectId] = new constructorFunction(this);\n          break;\n        }\n        case 'dispose': {\n          delete this.objects[data.objectId];\n          break;\n        }\n        case 'getter': {\n          const object = this.objects[data.objectId];\n          const result = object[data.methodName];\n          response.result = result;\n          break;\n        }\n        case 'factory': {\n          const object = this.objects[data.objectId];\n          const result = object[data.methodName].apply(object, data.methodArguments);\n          if (result) {\n            this.objects[data.newObjectId] = result;\n          }\n          response.result = Boolean(result);\n          break;\n        }\n        case 'method': {\n          const object = this.objects[data.objectId];\n          response.result = object[data.methodName].apply(object, data.methodArguments);\n          break;\n        }\n        case 'evaluateForTest': {\n          try {\n            response.result = self.eval(data.source);\n          } catch (error) {\n            response.result = error.toString();\n          }\n          break;\n        }\n      }\n    } catch (error) {\n      response.error = error.toString();\n      response.errorCallStack = error.stack;\n      if (data.methodName) {\n        response.errorMethodName = data.methodName;\n      }\n    }\n    this.postMessage(response);\n  }\n}\n"]}