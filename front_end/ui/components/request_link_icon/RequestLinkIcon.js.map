{"version":3,"file":"RequestLinkIcon.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/request_link_icon/RequestLinkIcon.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Common from '../../../core/common/common.js';\nimport * as NetworkForward from '../../../panels/network/forward/forward.js';\nimport type * as Logs from '../../../models/logs/logs.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as IconButton from '../../../ui/components/icon_button/icon_button.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\nimport requestLinkIconStyles from './requestLinkIcon.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Title for a link to show a request in the network panel\n   * @example {https://example.org/index.html} url\n   */\n  clickToShowRequestInTheNetwork: 'Click to open the network panel and show request for URL: {url}',\n  /**\n   * @description Title for an link to show a request that is unavailable because the request couldn't be resolved\n   */\n  requestUnavailableInTheNetwork: 'Request unavailable in the network panel, try reloading the inspected page',\n  /**\n   * @description Label for the shortened URL displayed in a link to show a request in the network panel\n   */\n  shortenedURL: 'Shortened URL',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/components/request_link_icon/RequestLinkIcon.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface RequestLinkIconData {\n  linkToPreflight?: boolean;\n  request?: SDK.NetworkRequest.NetworkRequest|null;\n  affectedRequest?: {requestId: Protocol.Network.RequestId, url?: string};\n  highlightHeader?: {section: NetworkForward.UIRequestLocation.UIHeaderSection, name: string};\n  networkTab?: NetworkForward.UIRequestLocation.UIRequestTabs;\n  requestResolver?: Logs.RequestResolver.RequestResolver;\n  displayURL?: boolean;\n  additionalOnClickAction?: () => void;\n  revealOverride?: (revealable: Object|null, omitFocus?: boolean|undefined) => Promise<void>;\n}\n\nexport const extractShortPath = (path: string): string => {\n  // 1st regex matches everything after last '/'\n  // if path ends with '/', 2nd regex returns everything between the last two '/'\n  return (/[^/]+$/.exec(path) || /[^/]+\\/$/.exec(path) || [''])[0];\n};\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nexport class RequestLinkIcon extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-request-link-icon`;\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private linkToPreflight?: boolean;\n  // The value `null` indicates that the request is not available,\n  // `undefined` that it is still being resolved.\n  private request?: SDK.NetworkRequest.NetworkRequest|null;\n  private highlightHeader?: {section: NetworkForward.UIRequestLocation.UIHeaderSection, name: string};\n  private requestResolver?: Logs.RequestResolver.RequestResolver;\n  private displayURL: boolean = false;\n  private networkTab?: NetworkForward.UIRequestLocation.UIRequestTabs;\n  private affectedRequest?: {requestId: Protocol.Network.RequestId, url?: string};\n  private additionalOnClickAction?: () => void;\n  private reveal = Common.Revealer.reveal;\n  private requestResolvedPromise = Promise.resolve<void>(undefined);\n\n  set data(data: RequestLinkIconData) {\n    this.linkToPreflight = data.linkToPreflight;\n    this.request = data.request;\n    if (data.affectedRequest) {\n      this.affectedRequest = {...data.affectedRequest};\n    }\n    this.highlightHeader = data.highlightHeader;\n    this.networkTab = data.networkTab;\n    this.requestResolver = data.requestResolver;\n    this.displayURL = data.displayURL ?? false;\n    this.additionalOnClickAction = data.additionalOnClickAction;\n    if (data.revealOverride) {\n      this.reveal = data.revealOverride;\n    }\n    if (!this.request && data.affectedRequest) {\n      this.requestResolvedPromise = this.resolveRequest(data.affectedRequest.requestId);\n    }\n    this.render();\n  }\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [requestLinkIconStyles];\n  }\n\n  private resolveRequest(requestId: Protocol.Network.RequestId): Promise<void> {\n    if (!this.requestResolver) {\n      throw new Error('A `RequestResolver` must be provided if an `affectedRequest` is provided.');\n    }\n    return this.requestResolver.waitFor(requestId)\n        .then(request => {\n          this.request = request;\n        })\n        .catch(() => {\n          this.request = null;\n        });\n  }\n\n  get data(): RequestLinkIconData {\n    return {\n      linkToPreflight: this.linkToPreflight,\n      request: this.request,\n      affectedRequest: this.affectedRequest,\n      highlightHeader: this.highlightHeader,\n      networkTab: this.networkTab,\n      requestResolver: this.requestResolver,\n      displayURL: this.displayURL,\n      additionalOnClickAction: this.additionalOnClickAction,\n      revealOverride: this.reveal !== Common.Revealer.reveal ? this.reveal : undefined,\n    };\n  }\n\n  private iconColor(): string {\n    if (!this.request) {\n      return '--issue-color-yellow';\n    }\n    return '--color-link';\n  }\n\n  iconData(): IconButton.Icon.IconData {\n    return {\n      iconName: 'network_panel_icon',\n      color: `var(${this.iconColor()})`,\n      width: '16px',\n      height: '16px',\n    };\n  }\n\n  handleClick(event: MouseEvent): void {\n    if (event.button !== 0) {\n      return;  // Only handle left-click for now.\n    }\n    const linkedRequest = this.linkToPreflight ? this.request?.preflightRequest() : this.request;\n    if (!linkedRequest) {\n      return;\n    }\n    if (this.highlightHeader) {\n      const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.header(\n          linkedRequest, this.highlightHeader.section, this.highlightHeader.name);\n      this.reveal(requestLocation);\n    } else {\n      const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.tab(\n          linkedRequest, this.networkTab ?? NetworkForward.UIRequestLocation.UIRequestTabs.Headers);\n      this.reveal(requestLocation);\n    }\n    this.additionalOnClickAction?.();\n  }\n\n  private getTooltip(): Platform.UIString.LocalizedString {\n    if (this.request) {\n      return i18nString(UIStrings.clickToShowRequestInTheNetwork, {url: this.request.url()});\n    }\n    return i18nString(UIStrings.requestUnavailableInTheNetwork);\n  }\n\n  private getUrlForDisplaying(): string|undefined {\n    if (!this.request) {\n      return this.affectedRequest?.url;\n    }\n    return this.request.url();\n  }\n\n  private maybeRenderURL(): LitHtml.TemplateResult|{} {\n    if (!this.displayURL) {\n      return LitHtml.nothing;\n    }\n    const url = this.getUrlForDisplaying();\n    if (!url) {\n      return LitHtml.nothing;\n    }\n    const filename = extractShortPath(url);\n    return LitHtml.html`<span aria-label=\"${i18nString(UIStrings.shortenedURL)}\" title=\"${url}\">${filename}</span>`;\n  }\n\n  private render(): Promise<void> {\n    return coordinator.write(() => {\n      // clang-format off\n      LitHtml.render(LitHtml.html`\n        ${LitHtml.Directives.until(this.requestResolvedPromise.then(() => this.renderComponent()), this.renderComponent())}\n      `,\n      this.shadow, {host: this});\n      // clang-format on\n    });\n  }\n\n  private renderComponent(): LitHtml.TemplateResult {\n    // clang-format off\n    return LitHtml.html`\n      <span class=${LitHtml.Directives.classMap({'link': Boolean(this.request)})}\n            @click=${this.handleClick}>\n        <${IconButton.Icon.Icon.litTagName} .data=${this.iconData() as IconButton.Icon.IconData}\n          title=${this.getTooltip()}></${IconButton.Icon.Icon.litTagName}>\n        ${this.maybeRenderURL()}\n      </span>`;\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-request-link-icon', RequestLinkIcon);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-request-link-icon': RequestLinkIcon;\n  }\n}\n"]}