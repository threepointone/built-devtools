{"version":3,"file":"IssueLinkIcon.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/issue_counter/IssueLinkIcon.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Common from '../../../core/common/common.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as IconButton from '../../../ui/components/icon_button/icon_button.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport * as IssuesManager from '../../../models/issues_manager/issues_manager.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\nimport IssueLinkIconStyles from './issueLinkIcon.css.js';\n\nimport {getIssueKindIconData} from './IssueCounter.js';\n\nconst UIStrings = {\n  /**\n   * @description Title for a link to show an issue in the issues tab\n   */\n  clickToShowIssue: 'Click to show issue in the issues tab',\n  /**\n   * @description Title for a link to show an issue in the issues tab\n   * @example {A title of an Issue} title\n   */\n  clickToShowIssueWithTitle: 'Click to open the issue tab and show issue: {title}',\n  /**\n   *@description Title for an link to show an issue that is unavailable because the issue couldn't be resolved\n   */\n  issueUnavailable: 'Issue unavailable at this time',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/components/issue_counter/IssueLinkIcon.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface IssueLinkIconData {\n  issue?: IssuesManager.Issue.Issue|null;\n  issueId?: Protocol.Audits.IssueId;\n  issueResolver?: IssuesManager.IssueResolver.IssueResolver;\n  additionalOnClickAction?: () => void;\n  revealOverride?: (revealable: Object|null, omitFocus?: boolean|undefined) => Promise<void>;\n}\n\nexport const extractShortPath = (path: string): string => {\n  // 1st regex matches everything after last '/'\n  // if path ends with '/', 2nd regex returns everything between the last two '/'\n  return (/[^/]+$/.exec(path) || /[^/]+\\/$/.exec(path) || [''])[0];\n};\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nexport class IssueLinkIcon extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-issue-link-icon`;\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  // The value `null` indicates that the issue is not available,\n  // `undefined` that it is still being resolved.\n  private issue?: IssuesManager.Issue.Issue|null;\n  private issueTitle: string|null = null;\n  private issueTitlePromise = Promise.resolve<void>(undefined);\n  private issueId?: Protocol.Audits.IssueId;\n  private issueResolver?: IssuesManager.IssueResolver.IssueResolver;\n  private additionalOnClickAction?: () => void;\n  private reveal = Common.Revealer.reveal;\n  private issueResolvedPromise = Promise.resolve<void>(undefined);\n\n  set data(data: IssueLinkIconData) {\n    this.issue = data.issue;\n    this.issueId = data.issueId;\n    if (!this.issue && !this.issueId) {\n      throw new Error('Either `issue` or `issueId` must be provided');\n    }\n    this.issueResolver = data.issueResolver;\n    this.additionalOnClickAction = data.additionalOnClickAction;\n    if (data.revealOverride) {\n      this.reveal = data.revealOverride;\n    }\n    if (!this.issue && this.issueId) {\n      this.issueResolvedPromise = this.resolveIssue(this.issueId);\n      this.issueTitlePromise = this.issueResolvedPromise.then(() => this.fetchIssueTitle());\n    } else {\n      this.issueTitlePromise = this.fetchIssueTitle();\n    }\n    this.render();\n  }\n\n  private async fetchIssueTitle(): Promise<void> {\n    const description = this.issue?.getDescription();\n    if (!description) {\n      return;\n    }\n    const title = await IssuesManager.MarkdownIssueDescription.getIssueTitleFromMarkdownDescription(description);\n    if (title) {\n      this.issueTitle = title;\n    }\n  }\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [IssueLinkIconStyles];\n  }\n\n  private resolveIssue(issueId: Protocol.Audits.IssueId): Promise<void> {\n    if (!this.issueResolver) {\n      throw new Error('An `IssueResolver` must be provided if an `issueId` is provided.');\n    }\n    return this.issueResolver.waitFor(issueId)\n        .then(issue => {\n          this.issue = issue;\n        })\n        .catch(() => {\n          this.issue = null;\n        });\n  }\n\n  get data(): IssueLinkIconData {\n    return {\n      issue: this.issue,\n      issueId: this.issueId,\n      issueResolver: this.issueResolver,\n      additionalOnClickAction: this.additionalOnClickAction,\n      revealOverride: this.reveal !== Common.Revealer.reveal ? this.reveal : undefined,\n    };\n  }\n\n  iconData(): IconButton.Icon.IconData {\n    if (this.issue) {\n      return getIssueKindIconData(this.issue.getKind());\n    }\n    return {iconName: 'issue-questionmark-icon', color: 'var(--color-text-secondary)', width: '16px', height: '16px'};\n  }\n\n  handleClick(event: MouseEvent): void {\n    if (event.button !== 0) {\n      return;  // Only handle left-click for now.\n    }\n    if (this.issue) {\n      this.reveal(this.issue);\n    }\n    this.additionalOnClickAction?.();\n  }\n\n  private getTooltip(): Platform.UIString.LocalizedString {\n    if (this.issueTitle) {\n      return i18nString(UIStrings.clickToShowIssueWithTitle, {title: this.issueTitle});\n    }\n    if (this.issue) {\n      return i18nString(UIStrings.clickToShowIssue);\n    }\n    return i18nString(UIStrings.issueUnavailable);\n  }\n\n  private render(): Promise<void> {\n    return coordinator.write(() => {\n      // clang-format off\n      LitHtml.render(LitHtml.html`\n        ${LitHtml.Directives.until(this.issueTitlePromise.then(() => this.renderComponent()), this.issueResolvedPromise.then(() => this.renderComponent()), this.renderComponent())}\n      `,\n      this.shadow, {host: this});\n      // clang-format on\n    });\n  }\n\n  private renderComponent(): LitHtml.TemplateResult {\n    // clang-format off\n    return LitHtml.html`\n      <span class=${LitHtml.Directives.classMap({'link': Boolean(this.issue)})}\n            @click=${this.handleClick}>\n        <${IconButton.Icon.Icon.litTagName} .data=${this.iconData() as IconButton.Icon.IconData}\n          title=${this.getTooltip()}></${IconButton.Icon.Icon.litTagName}>\n      </span>`;\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-issue-link-icon', IssueLinkIcon);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-issue-link-icon': IssueLinkIcon;\n  }\n}\n"]}