{"version":3,"file":"WebauthnPane.js","sourceRoot":"","sources":["../../../../../../front_end/panels/webauthn/WebauthnPane.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,6BAA6B,CAAC;AACtD,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAChD,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAChD,OAAO,KAAK,GAAG,MAAM,uBAAuB,CAAC;AAE7C,OAAO,KAAK,QAAQ,MAAM,mDAAmD,CAAC;AAC9E,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAEhD,OAAO,kBAAkB,MAAM,uBAAuB,CAAC;AAEvD,MAAM,SAAS,GAAG;IAChB;;MAEE;IACF,MAAM,EAAE,QAAQ;IAChB;;MAEE;IACF,MAAM,EAAE,QAAQ;IAChB;;;MAGE;IACF,gCAAgC,EAAE,sDAAsD;IACxF;;MAEE;IACF,0BAA0B,EAAE,0CAA0C;IACtE;;MAEE;IACF,EAAE,EAAE,IAAI;IACR;;MAEE;IACF,UAAU,EAAE,aAAa;IACzB;;MAEE;IACF,IAAI,EAAE,OAAO;IACb;;MAEE;IACF,UAAU,EAAE,aAAa;IACzB;;;MAGE;IACF,SAAS,EAAE,iBAAiB;IAC5B;;MAEE;IACF,OAAO,EAAE,SAAS;IAClB;;MAEE;IACF,WAAW,EAAE,aAAa;IAC1B;;MAEE;IACF,+BAA+B,EAAE,oDAAoD;IACrF;;MAEE;IACF,SAAS,EAAE,YAAY;IACvB;;MAEE;IACF,gBAAgB,EAAE,mBAAmB;IACrC;;MAEE;IACF,QAAQ,EAAE,UAAU;IACpB;;MAEE;IACF,SAAS,EAAE,WAAW;IACtB;;MAEE;IACF,oBAAoB,EAAE,wBAAwB;IAC9C;;MAEE;IACF,GAAG,EAAE,KAAK;IACV;;MAEE;IACF,gBAAgB,EAAE,mBAAmB;IACrC;;MAEE;IACF,MAAM,EAAE,QAAQ;IAChB;;MAEE;IACF,QAAQ,EAAE,WAAW;IACrB;;MAEE;IACF,QAAQ,EAAE,WAAW;IACrB;;;MAGE;IACF,cAAc,EAAE,qBAAqB;IACrC;;MAEE;IACF,aAAa,EAAE,iBAAiB;IAChC;;MAEE;IACF,IAAI,EAAE,MAAM;IACZ;;MAEE;IACF,wBAAwB,EAAE,4BAA4B;IACtD;;MAEE;IACF,GAAG,EAAE,KAAK;IACV;;MAEE;IACF,EAAE,EAAE,IAAI;IACR;;;MAGE;IACF,4BAA4B,EAAE,uCAAuC;CACtE,CAAC;AACF,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,iCAAiC,EAAE,SAAS,CAAC,CAAC;AACvF,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AACtE,MAAM,OAAO,GAAG,IAAI,CAAC;AAOrB,MAAM,YAAa,SAAQ,QAAQ,CAAC,QAAQ,CAAC,YAA0B;IACrE,YAAY,UAAwC;QAClD,KAAK,CAAC,UAAU,CAAC,CAAC;IACpB,CAAC;IAED,cAAc;QACZ,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,UAAU,CAAC,QAAgB;QACzB,MAAM,IAAI,GAAG,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACxC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC,CAAC;QAEzD,IAAI,QAAQ,KAAK,SAAS,EAAE;YAC1B,OAAO,IAAI,CAAC;SACb;QAED,MAAM,YAAY,GAAG,EAAE,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,GAAS,EAAE;YACxF,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACjB,IAAI,CAAC,QAAQ,CAAC,wBAAwB,4CAA0B,IAAI,CAAC,IAAI,CAAC,CAAC;aAC5E;QACH,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;QAE/B,MAAM,YAAY,GAAG,EAAE,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,GAAS,EAAE;YACxF,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACjB,IAAI,CAAC,QAAQ,CAAC,wBAAwB,4CAA0B,IAAI,CAAC,IAAI,CAAC,CAAC;aAC5E;QACH,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;QAE/B,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AAED,MAAM,iBAAkB,SAAQ,QAAQ,CAAC,QAAQ,CAAC,YAA0B;IAC1E,WAAW,CAAC,OAAgB;QAC1B,OAAO,CAAC,cAAc,EAAE,CAAC;QACzB,MAAM,EAAE,GAAI,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAA0B,CAAC;QAC5F,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,MAAM,CAAC;SACvD;QAED,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,EAAE,EAAC,EAAE,EAAE,aAAa,EAAC,CAAC,CAAC;QACjE,IAAI,CAAC,WAAW,GAAG,gCAAgC,CAAC;QACpD,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC3B,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,wBAAwB,CAAC,IAAI,EAAE,SAAS,CAAC,gCAAgC,EAAE,EAAC,GAAG,EAAE,IAAI,EAAC,CAAC,CAAC;QAElH,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACxB,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;IAC1B,CAAC;CACF;AAOD,IAAI,wBAA0C,CAAC;AAE/C,sFAAsF;AACtF,oFAAoF;AACpF,iCAAiC;AACjC,MAAM,YAAY,GAAG,SAAS,CAAC;AAC/B,MAAM,kBAAkB,GAAG,cAAc,YAAY;CACpD,CAAC;AACF,MAAM,kBAAkB,GAAG,YAAY,YAAY,WAAW,CAAC;AAE/D,MAAM,6BAA6B,GAA4E;IAC7G,KAAK,qBAA+C;IACpD,GAAG,iBAA6C;CACjD,CAAC;AAEF,MAAM,OAAO,gBAAiB,SAAQ,EAAE,CAAC,MAAM,CAAC,IAAI;IAC1C,OAAO,CAAU;IACjB,YAAY,CAAyC;IACrD,cAAc,CAAU;IACf,SAAS,CAAuF;IACjH,aAAa;IACL,cAAc,CAA6B;IAClC,6BAA6B,CAA2D;IACjG,KAAK,CAAiD;IACtD,kBAAkB,CAAc;IAChC,mBAAmB,CAAwB;IAC3C,UAAU,CAA+B;IACzC,aAAa,CAAwB;IACrC,uBAAuB,CAAwB;IAC/C,oBAAoB,CAAwB;IAC5C,cAAc,CAA8B;IAC5C,eAAe,CAA8B;IAC7C,wBAAwB,CAAqC;IAC7D,mBAAmB,CAA6B;IAChD,6BAA6B,CAAqC;IAClE,wBAAwB,CAA6B;IACrD,sBAAsB,CAA8B;IACpD,UAAU,CAAiB;IAEnC;QACE,KAAK,CAAC,IAAI,CAAC,CAAC;QAEZ,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QACnD,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;QAC5B,IAAI,CAAC,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;QAE3B,IAAI,CAAC,6BAA6B;YAC7B,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,aAAa,CAAC,wBAAwB,EAAE,EAAE,CACrB,CAAC;QAE/D,MAAM,UAAU,GAAG,GAAG,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC,UAAU,EAAE,CAAC;QAC3E,IAAI,UAAU,EAAE;YACd,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;SAChE;QAED,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;QACxF,IAAI,CAAC,6BAA6B,EAAE,CAAC;QACrC,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC;IAED,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAC,QAAQ,EAAE,IAAI,EAAC;QACrC,MAAM,EAAC,QAAQ,EAAC,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,wBAAwB,IAAI,QAAQ,EAAE;YACzC,wBAAwB,GAAG,IAAI,gBAAgB,EAAE,CAAC;SACnD;QAED,OAAO,wBAAwB,CAAC;IAClC,CAAC;IAEO,KAAK,CAAC,yBAAyB;QACrC,IAAI,qBAAqB,GAA2C,IAAI,CAAC;QACzE,MAAM,uBAAuB,GAAG,IAAI,CAAC,6BAA6B,CAAC,GAAG,EAAE,CAAC;QACzE,KAAK,MAAM,OAAO,IAAI,uBAAuB,EAAE;YAC7C,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBACf,SAAS;aACV;YAED,MAAM,eAAe,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;YACnE,IAAI,CAAC,uBAAuB,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;YACvD,8CAA8C;YAC9C,OAAO,CAAC,eAAe,GAAG,eAAe,CAAC;YAC1C,IAAI,OAAO,CAAC,MAAM,EAAE;gBAClB,qBAAqB,GAAG,eAAe,CAAC;aACzC;SACF;QAED,2DAA2D;QAC3D,IAAI,CAAC,6BAA6B,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;QAChE,IAAI,qBAAqB,EAAE;YACzB,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,CAAC,CAAC;SACpD;IACH,CAAC;IAED,KAAK,CAAC,iBAAiB;QACrB,IAAI,IAAI,CAAC,cAAc,EAAE;YACvB,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;SACvC;QACD,MAAM,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;IAC7C,CAAC;IAEO,aAAa;QACnB,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,4BAA4B,CAAC,CAAC;QAChG,IAAI,CAAC,UAAU,GAAG,IAAI,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,kBAAkB,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;QACvF,MAAM,mBAAmB,GAAG,UAAU,CAAC,SAAS,CAAC,0BAA0B,CAAC,CAAC;QAC7E,IAAI,CAAC,cAAc;YACf,IAAI,EAAE,CAAC,OAAO,CAAC,eAAe,CAAC,mBAAmB,EAAE,mBAAmB,EAAE,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACnH,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IACzD,CAAC;IAEO,yBAAyB,CAAC,eAAkD;QAElF,MAAM,OAAO,GAAI;YACf;gBACE,EAAE,EAAE,cAAc;gBAClB,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC;gBAC/B,QAAQ,EAAE,IAAI;gBACd,MAAM,EAAE,EAAE;aACX;YACD;gBACE,EAAE,EAAE,sBAAsB;gBAC1B,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,UAAU,CAAC;gBACvC,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,OAAO;gBAC5C,MAAM,EAAE,EAAE;aACX;YACD;gBACE,EAAE,EAAE,MAAM;gBACV,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC;aAClC;YACD;gBACE,EAAE,EAAE,YAAY;gBAChB,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,UAAU,CAAC;aACxC;YACD;gBACE,EAAE,EAAE,WAAW;gBACf,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC;aACvC;YACD,EAAC,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,OAAO,CAAC,EAAC;SACb,CAAC;QAE3C,MAAM,cAAc,GAAG;YACrB,WAAW,EAAE,UAAU,CAAC,SAAS,CAAC,WAAW,CAAC;YAC9C,OAAO;YACP,YAAY,EAAE,SAAS;YACvB,cAAc,EAAE,SAAS;YACzB,eAAe,EAAE,SAAS;SAC3B,CAAC;QACF,MAAM,QAAQ,GAAG,IAAI,QAAQ,CAAC,QAAQ,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;QACpE,QAAQ,CAAC,YAAY,EAAE,CAAC;QACxB,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC1B,QAAQ,CAAC,gBAAgB,4CAA0B,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;QACtF,QAAQ,CAAC,gBAAgB,4CAA0B,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC,CAAC;QAE5G,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe,EAAE,QAAQ,CAAC,CAAC;QAE9C,OAAO,QAAQ,CAAC;IAClB,CAAC;IAEO,sBAAsB,CAAC,CAAuC;QACpE,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;IAChC,CAAC;IAEO,sBAAsB,CAAC,eAAkD,EAAE,CAElF;QACC,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IAC9D,CAAC;IAEO,KAAK,CAAC,iBAAiB,CAAC,eAAkD;QAChF,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QACrD,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO;SACR;QAED,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;YAErE,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,EAAE,CAAC;YACrC,KAAK,MAAM,UAAU,IAAI,WAAW,EAAE;gBACpC,MAAM,IAAI,GAAG,IAAI,YAAY,CAAC,UAAU,CAAC,CAAC;gBAC1C,QAAQ,CAAC,QAAQ,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;aACvC;YAED,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;SAClC;QAED,qGAAqG;QACrG,UAAU,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,EAAE,eAAe,CAAC,EAAE,OAAO,CAAC,CAAC;IAC1E,CAAC;IAEO,iBAAiB,CAAC,QAAsD;QAC9E,IAAI,QAAQ,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,MAAM,EAAE;YACvC,OAAO;SACR;QAED,MAAM,IAAI,GAAG,IAAI,iBAAiB,EAAE,CAAC;QACrC,QAAQ,CAAC,QAAQ,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IACxC,CAAC;IAEO,KAAK,CAAC,wBAAwB,CAAC,MAAe;QACpD,MAAM,IAAI,CAAC,UAAU,CAAC;QACtB,IAAI,CAAC,UAAU,GAAG,IAAI,OAAO,CAAO,KAAK,EAAE,OAA8B,EAAE,EAAE;YAC3E,IAAI,MAAM,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gBAClC,mDAAmD;gBACnD,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,sCAAsC,CAAC,CAAC;gBAC7F,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;aAC5B;YACD,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;YACtB,IAAI,IAAI,CAAC,KAAK,EAAE;gBACd,MAAM,IAAI,CAAC,KAAK,CAAC,wBAAwB,CAAC,MAAM,CAAC,CAAC;aACnD;YAED,IAAI,MAAM,EAAE;gBACV,MAAM,IAAI,CAAC,yBAAyB,EAAE,CAAC;aACxC;iBAAM;gBACL,IAAI,CAAC,2BAA2B,EAAE,CAAC;aACpC;YAED,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;YAC9B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;YAC5B,OAAO,EAAE,CAAC;QACZ,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,gBAAgB,CAAC,OAAgB;QACvC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;IAC3D,CAAC;IAEO,2BAA2B;QACjC,IAAI,CAAC,kBAAkB,CAAC,SAAS,GAAG,EAAE,CAAC;QACvC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;IACzB,CAAC;IAEO,oBAAoB,CAAC,CAAa;QACxC,IAAI,CAAC,wBAAwB,CAAE,CAAC,CAAC,MAA2B,CAAC,OAAO,CAAC,CAAC;IACxE,CAAC;IAEO,6BAA6B,CAAC,cAA0D;QAC9F,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE;YACzB,OAAO;SACR;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC;QAC7C,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,CAAC;QAEtC,KAAK,MAAM,MAAM,IAAI,cAAc,EAAE;YACnC,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;SAC9D;QAED,yDAAyD;QACzD,IAAI,CAAC,eAAe,CAAC,KAAK,GAAG,SAAS,CAAC;QACvC,sDAAsD;QACtD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE;YAC/B,oCAAoC;YACpC,IAAI,CAAC,eAAe,CAAC,aAAa,GAAG,CAAC,CAAC;SACxC;IACH,CAAC;IAEO,oCAAoC;QAC1C,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,mBAAmB,IAAI,CAAC,IAAI,CAAC,wBAAwB,EAAE;YACvF,OAAO;SACR;QAED,IAAI,IAAI,CAAC,cAAc,CAAC,KAAK,wBAAkD,EAAE;YAC/E,IAAI,CAAC,mBAAmB,CAAC,QAAQ,GAAG,KAAK,CAAC;YAC1C,IAAI,CAAC,wBAAwB,CAAC,QAAQ,GAAG,KAAK,CAAC;YAC/C,IAAI,CAAC,6BAA6B,CAAC;;;;;aAOlC,CAAC,CAAC;SACJ;aAAM;YACL,IAAI,CAAC,mBAAmB,CAAC,OAAO,GAAG,KAAK,CAAC;YACzC,IAAI,CAAC,mBAAmB,CAAC,QAAQ,GAAG,IAAI,CAAC;YACzC,IAAI,CAAC,wBAAwB,CAAC,OAAO,GAAG,KAAK,CAAC;YAC9C,IAAI,CAAC,wBAAwB,CAAC,QAAQ,GAAG,IAAI,CAAC;YAC9C,IAAI,CAAC,6BAA6B,CAAC;;;;aAIlC,CAAC,CAAC;SACJ;IACH,CAAC;IAEO,6BAA6B;QACnC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;QAC1E,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAA;;IAE/C,UAAU,CAAC,SAAS,CAAC,+BAA+B,CAAC;IAEjD,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CACjB,4DAA4D,EAAE,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;;GAEvG,CAAC,CAAC;QAED,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,6BAA6B,CAAC,CAAC;QACrG,MAAM,qBAAqB,GACvB,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,gBAAgB,CAAC,EAAE,yBAAyB,CAAC,CAAC;QAC9F,IAAI,CAAC,uBAAuB,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAC;QAChE,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,uBAAuB,CAAC,WAAW,CAAC,KAAK,EAAE,wBAAwB,CAAC,CAAC;QAEtG,MAAM,aAAa,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,KAAK,EAAE,sBAAsB,CAAC,CAAC;QAC3F,MAAM,cAAc,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,KAAK,EAAE,sBAAsB,CAAC,CAAC;QAC5F,MAAM,gBAAgB,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,KAAK,EAAE,sBAAsB,CAAC,CAAC;QAC9F,MAAM,qBAAqB,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,KAAK,EAAE,sBAAsB,CAAC,CAAC;QACnG,MAAM,cAAc,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,KAAK,EAAE,sBAAsB,CAAC,CAAC;QAE5F,MAAM,mBAAmB,GAAG,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,4BAA4B,CAAC,CAAC;QACjH,aAAa,CAAC,WAAW,CAAC,mBAAmB,CAAC,CAAC;QAC/C,IAAI,CAAC,cAAc,GAAI,aAAa,CAAC,WAAW,CAAC,QAAQ,EAAE,eAAe,CAAuB,CAAC;QAClG,EAAE,CAAC,SAAS,CAAC,kBAAkB,CAAC,mBAAmB,EAAG,IAAI,CAAC,cAA0B,CAAC,CAAC;QACvF,MAAM,CAAC,MAAM,CAAC,6BAA6B,CAAC;aACvC,IAAI,EAAE;aACN,OAAO,CAAC,CAAC,MAA+C,EAAQ,EAAE;YACjE,IAAI,IAAI,CAAC,cAAc,EAAE;gBACvB,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;aAC7D;QACH,CAAC,CAAC,CAAC;QAEP,IAAI,IAAI,CAAC,cAAc,EAAE;YACvB,IAAI,CAAC,cAAc,CAAC,KAAK,sBAAgD,CAAC;SAC3E;QAED,MAAM,oBAAoB,GAAG,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE,4BAA4B,CAAC,CAAC;QACnH,cAAc,CAAC,WAAW,CAAC,oBAAoB,CAAC,CAAC;QACjD,IAAI,CAAC,eAAe,GAAI,cAAc,CAAC,WAAW,CAAC,QAAQ,EAAE,eAAe,CAAuB,CAAC;QACpG,EAAE,CAAC,SAAS,CAAC,kBAAkB,CAAC,oBAAoB,EAAG,IAAI,CAAC,eAA2B,CAAC,CAAC;QACzF,6EAA6E;QAE7E,IAAI,CAAC,wBAAwB,GAAG,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,oBAAoB,CAAC,EAAE,KAAK,CAAC,CAAC;QACnH,IAAI,CAAC,wBAAwB,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;QACtF,gBAAgB,CAAC,WAAW,CAAC,IAAI,CAAC,wBAAwB,CAAC,WAAW,CAAC,CAAC;QACxE,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,wBAAwB,CAAC,eAAe,CAAC;QACzE,IAAI,CAAC,mBAAmB,CAAC,OAAO,GAAG,KAAK,CAAC;QACzC,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;QACxE,gBAAgB,CAAC,WAAW,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAE5D,IAAI,CAAC,6BAA6B,GAAG,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAC;QAC1G,IAAI,CAAC,6BAA6B,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;QAC3F,qBAAqB,CAAC,WAAW,CAAC,IAAI,CAAC,6BAA6B,CAAC,WAAW,CAAC,CAAC;QAClF,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,6BAA6B,CAAC,eAAe,CAAC;QACnF,IAAI,CAAC,wBAAwB,CAAC,OAAO,GAAG,KAAK,CAAC;QAC9C,IAAI,CAAC,wBAAwB,CAAC,SAAS,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;QAC7E,qBAAqB,CAAC,WAAW,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;QAEtE,IAAI,CAAC,sBAAsB;YACvB,EAAE,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;QAC7G,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,4BAA4B,CAAC,CAAC;QAChE,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;QACxD,MAAM,qBAAqB,GAAG,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,gBAAgB,CAAC,EAAE,EAAE,CAAC,CAAC;QACjG,EAAE,CAAC,SAAS,CAAC,kBAAkB,CAAC,qBAAqB,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;QAEpF,IAAI,CAAC,oCAAoC,EAAE,CAAC;QAC5C,IAAI,IAAI,CAAC,cAAc,EAAE;YACvB,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,oCAAoC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SACtG;IACH,CAAC;IAEO,KAAK,CAAC,4BAA4B;QACxC,MAAM,OAAO,GAAG,IAAI,CAAC,8BAA8B,EAAE,CAAC;QACtD,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,MAAM,eAAe,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;YACnE,MAAM,uBAAuB,GAAG,IAAI,CAAC,6BAA6B,CAAC,GAAG,EAAE,CAAC;YACzE,uBAAuB,CAAC,IAAI,CAAC,EAAC,eAAe,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,OAAO,EAAC,CAAC,CAAC;YAC1E,IAAI,CAAC,6BAA6B,CAAC,GAAG,CAClC,uBAAuB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAC,GAAG,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC,eAAe,KAAK,eAAe,EAAC,CAAC,CAAC,CAAC,CAAC;YAC/F,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,uBAAuB,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;YAC7E,MAAM,cAAc,GAAG,MAAM,CAAC,UAAU,CAAC,kCAAkC,CAAC,CAAC;YAC7E,MAAM,oBAAoB,GAAG,cAAc,CAAC,OAAO,CAAC;YACpD,OAAO,CAAC,cAAc,CAAC,EAAC,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,oBAAoB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,EAAC,CAAC,CAAC;SAC9F;IACH,CAAC;IAEO,KAAK,CAAC,uBAAuB,CACjC,eAAkD,EAClD,OAAsD;QACxD,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC9C,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;QAC/C,OAAO,CAAC,YAAY,CAAC,uBAAuB,EAAE,eAAe,CAAC,CAAC;QAC/D,IAAI,CAAC,kBAAkB,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QAE7C,MAAM,aAAa,GAAG,OAAO,CAAC,WAAW,CAAC,KAAK,EAAE,8BAA8B,CAAC,CAAC;QACjF,MAAM,YAAY,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,6BAA6B,CAAC,CAAC;QACrF,EAAE,CAAC,SAAS,CAAC,aAAa,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;QAE5C,MAAM,IAAI,CAAC,wBAAwB,EAAE,CAAC;QACtC,MAAM,qBAAqB,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,yBAAyB,CAAC,CAAC;QAC1F,MAAM,WAAW,GACb,EAAE,CAAC,OAAO,CAAC,gBAAgB,CAAC,wBAAwB,eAAe,EAAE,EAAE,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;QACzG,WAAW,CAAC,YAAY,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC,CAAC;QAC5G,qBAAqB,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;QAC/C,gCAAgC,CAAE,WAAW,CAAC,YAAiC,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/F,IAAI,CAAC,YAAY,GAAG,eAAe,CAAC,CAAE,4DAA4D;QAElG,MAAM,YAAY,GAAG,aAAa,CAAC,WAAW,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAC;QACxE,YAAY,CAAC,WAAW,GAAG,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QACxD,YAAY,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC,CAAC;QAE7F,MAAM,OAAO,GAAG,IAAI,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC;QAC1E,MAAM,QAAQ,GAAG,IAAI,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,gBAAgB,CAAC,CAAC;QAChG,MAAM,QAAQ,GAAG,IAAI,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,qBAAqB,CAAC,CAAC;QACrG,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;QAE3B,MAAM,SAAS,GAAI,YAAY,CAAC,WAAW,CAAC,OAAO,EAAE,0BAA0B,CAAsB,CAAC;QACtG,SAAS,CAAC,QAAQ,GAAG,IAAI,CAAC;QAC1B,MAAM,gBAAgB,GAAG,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAE,uDAAuD;QAC5G,SAAS,CAAC,KAAK,GAAG,UAAU,CAAC,SAAS,CAAC,cAAc,EAAE,EAAC,GAAG,EAAE,gBAAgB,EAAC,CAAC,CAAC;QAChF,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;QAE1D,QAAQ,CAAC,gBAAgB,CACrB,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,KAAK,EACrC,GAAS,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,YAAY,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC;QACxF,QAAQ,CAAC,gBAAgB,CACrB,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,KAAK,EACrC,GAAS,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,YAAY,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC,CAAC;QAErG,SAAS,CAAC,gBAAgB,CACtB,UAAU,EAAE,GAAS,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,YAAY,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC,CAAC;QACjH,SAAS,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAoB,EAAQ,EAAE;YACnE,IAAI,KAAK,CAAC,GAAG,KAAK,OAAO,EAAE;gBACzB,IAAI,CAAC,oBAAoB,CAAC,YAAY,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC;aACrF;QACH,CAAC,CAAC,CAAC;QAEH,OAAO,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QACpC,OAAO,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QAEpC,IAAI,CAAC,yBAAyB,CAAC,OAAO,EAAE,eAAe,EAAE,OAAO,CAAC,CAAC;QAElE,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC5C,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QACzC,KAAK,CAAC,WAAW,GAAG,UAAU,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;QACtD,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAE3B,MAAM,QAAQ,GAAG,IAAI,CAAC,yBAAyB,CAAC,eAAe,CAAC,CAAC;QACjE,QAAQ,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAElC,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,CAAC;QAExC,OAAO,OAAO,CAAC;IACjB,CAAC;IAEO,gBAAgB,CAAC,UAAwC;QAC/D,IAAI,GAAG,GAAG,kBAAkB,CAAC;QAC7B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,EAAE;YACzD,GAAG,IAAI,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC;SAC1D;QACD,GAAG,IAAI,kBAAkB,CAAC;QAE1B,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QACzC,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;QACpD,IAAI,CAAC,IAAI,GAAG,8BAA8B,GAAG,kBAAkB,CAAC,GAAG,CAAC,CAAC;QACrE,IAAI,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAEO,KAAK,CAAC,gBAAgB,CAAC,eAAkD,EAAE,YAAoB;QAErG,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QACrD,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO;SACR;QAED,kDAAkD;QAClD,QAAQ,CAAC,QAAQ,EAAE;aACd,QAAQ;aACR,IAAI,CAAC,CAAC,CAA+C,EAAW,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,KAAK,YAAY,CAAC;aACxG,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QAEjC,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,MAAM,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,eAAe,EAAE,YAAY,CAAC,CAAC;SAClE;IACH,CAAC;IAED;;OAEG;IACK,yBAAyB,CAC7B,OAAgB,EAAE,eAAuB,EAAE,OAAsD;QACnG,MAAM,aAAa,GAAG,OAAO,CAAC,WAAW,CAAC,KAAK,EAAE,sBAAsB,CAAC,CAAC;QACzE,MAAM,SAAS,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;QAC1E,MAAM,aAAa,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;QAC9E,MAAM,cAAc,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;QAC/E,MAAM,QAAQ,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;QACzE,MAAM,QAAQ,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,qBAAqB,CAAC,CAAC;QAEzE,SAAS,CAAC,WAAW,CAAC,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,4BAA4B,CAAC,CAAC,CAAC;QACxG,aAAa,CAAC,WAAW,CAAC,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,4BAA4B,CAAC,CAAC,CAAC;QAChH,cAAc,CAAC,WAAW,CAAC,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE,4BAA4B,CAAC,CAAC,CAAC;QAClH,QAAQ,CAAC,WAAW,CAChB,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,oBAAoB,CAAC,EAAE,4BAA4B,CAAC,CAAC,CAAC;QACtG,QAAQ,CAAC,WAAW,CAChB,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,wBAAwB,CAAC,EAAE,4BAA4B,CAAC,CAAC,CAAC;QAE1G,SAAS,CAAC,WAAW,CAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,WAAW,GAAG,eAAe,CAAC;QACxF,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,WAAW,GAAG,OAAO,CAAC,QAAQ,CAAC;QAC7F,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,WAAW,GAAG,OAAO,CAAC,SAAS,CAAC;QAC/F,QAAQ,CAAC,WAAW,CAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,WAAW;YAChE,OAAO,CAAC,cAAc,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QAClF,QAAQ,CAAC,WAAW,CAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,WAAW;YAChE,OAAO,CAAC,mBAAmB,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;IACzF,CAAC;IAEO,oBAAoB,CACxB,YAAqB,EAAE,SAA2B,EAAE,QAAkC,EACtF,QAAkC;QACpC,SAAS,CAAC,QAAQ,GAAG,KAAK,CAAC;QAC3B,YAAY,CAAC,SAAS,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC3C,SAAS,CAAC,KAAK,EAAE,CAAC;QAClB,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC1B,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;IAC7B,CAAC;IAEO,oBAAoB,CACxB,YAAqB,EAAE,SAA2B,EAAE,QAAgC,EACpF,QAAgC,EAAE,WAA2C;QAC/E,SAAS,CAAC,QAAQ,GAAG,IAAI,CAAC;QAC1B,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QAC9C,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC1B,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;QAC3B,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;IAC5D,CAAC;IAEO,sBAAsB,CAAC,WAA2C,EAAE,iBAAyB;QACnG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CACtB,WAAW,CAAC,YAAY,EAAE,UAAU,CAAC,SAAS,CAAC,4BAA4B,EAAE,EAAC,GAAG,EAAE,iBAAiB,EAAC,CAAC,CAAC,CAAC;IAC9G,CAAC;IAED;;OAEG;IACK,mBAAmB,CAAC,eAAkD;QAC5E,IAAI,IAAI,CAAC,kBAAkB,EAAE;YAC3B,MAAM,KAAK,GAAG,IAAI,CAAC,kBAAkB,CAAC,aAAa,CAAC,0BAA0B,GAAG,CAAC,MAAM,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;YAC9G,IAAI,KAAK,EAAE;gBACT,KAAK,CAAC,MAAM,EAAE,CAAC;aAChB;SACF;QACD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAEvC,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,eAAe,CAAC,CAAC;SACjD;QAED,0CAA0C;QAC1C,MAAM,2BAA2B,GAAG,IAAI,CAAC,6BAA6B,CAAC,GAAG,EAAE,CAAC;QAC7E,MAAM,0BAA0B,GAAG,2BAA2B,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,eAAe,KAAK,eAAe,CAAC,CAAC;QAClH,IAAI,CAAC,6BAA6B,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;QAEnE,IAAI,IAAI,CAAC,YAAY,KAAK,eAAe,EAAE;YACzC,MAAM,yBAAyB,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC;YACpE,IAAI,yBAAyB,CAAC,MAAM,EAAE;gBACpC,IAAI,CAAC,sBAAsB,CAAC,yBAAyB,CAAC,CAAC,CAAC,CAAC,CAAC;aAC3D;iBAAM;gBACL,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;aAC1B;SACF;IACH,CAAC;IAEO,8BAA8B;QACpC,qEAAqE;QACrE,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,mBAAmB,IAAI,CAAC,IAAI,CAAC,wBAAwB,EAAE;YAChH,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;SACjE;QAED;;WAEG;QACH,MAAM,OAAO,GAAI;YACf,QAAQ,EAAE,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,KAAK;YAC9E,SAAS,EAAE,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC,KAAK;YACjF,cAAc,EAAE,IAAI,CAAC,mBAAmB,CAAC,OAAO;YAChD,mBAAmB,EAAE,IAAI,CAAC,wBAAwB,CAAC,OAAO;YAC1D,2BAA2B,EAAE,IAAI;YACjC,cAAc,EAAE,IAAI;SAC6B,CAAC;QAEpD,OAAO,OAAO,CAAC;IACjB,CAAC;IAED;;;OAGG;IACK,KAAK,CAAC,sBAAsB,CAAC,eAAkD;QACrF,MAAM,IAAI,CAAC,wBAAwB,EAAE,CAAC;QACtC,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,MAAM,IAAI,CAAC,KAAK,CAAC,8BAA8B,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;SACxE;QACD,IAAI,CAAC,YAAY,GAAG,eAAe,CAAC;QAEpC,MAAM,2BAA2B,GAAG,IAAI,CAAC,6BAA6B,CAAC,GAAG,EAAE,CAAC;QAC7E,MAAM,0BAA0B,GAC5B,2BAA2B,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAC,GAAG,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC,eAAe,KAAK,eAAe,EAAC,CAAC,CAAC,CAAC;QAClG,IAAI,CAAC,6BAA6B,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;QAEnE,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAEO,mBAAmB;QACzB,MAAM,cAAc,GAAG,IAAI,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,uBAAuB,CAAC,CAAC;QAC/F,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,CAAC,aAAsB,EAAQ,EAAE;YAClE,MAAM,MAAM,GAAI,aAAa,CAAC,aAAa,CAAC,uBAAuB,CAAsB,CAAC;YAC1F,IAAI,CAAC,MAAM,EAAE;gBACX,OAAO;aACR;YACD,MAAM,CAAC,OAAO;gBACV,2BAA2B,CAAE,aAA6B,CAAC,OAAO,CAAC,eAAe,KAAK,IAAI,CAAC,YAAY,CAAC;QAC/G,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,KAAK,CAAC,wBAAwB;QACpC,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,KAAK,EAAE;YACnC,MAAM,IAAI,CAAC,KAAK,CAAC,8BAA8B,CAAC,IAAI,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;SAC3E;QACD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IACD,QAAQ;QACN,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjB,IAAI,CAAC,gBAAgB,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC;IAC9C,CAAC;CACF","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as DataGrid from '../../ui/legacy/components/data_grid/data_grid.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport webauthnPaneStyles from './webauthnPane.css.js';\n\nconst UIStrings = {\n  /**\n  *@description Label for button that allows user to download the private key related to a credential.\n  */\n  export: 'Export',\n  /**\n  *@description Label for an item to remove something\n  */\n  remove: 'Remove',\n  /**\n  *@description Label for empty credentials table.\n  *@example {navigator.credentials.create()} PH1\n  */\n  noCredentialsTryCallingSFromYour: 'No credentials. Try calling {PH1} from your website.',\n  /**\n  *@description Label for checkbox to toggle the virtual authenticator environment allowing user to interact with software-based virtual authenticators.\n  */\n  enableVirtualAuthenticator: 'Enable virtual authenticator environment',\n  /**\n  *@description Label for ID field for credentials.\n  */\n  id: 'ID',\n  /**\n  *@description Label for field that describes whether a credential is a resident credential.\n  */\n  isResident: 'Is Resident',\n  /**\n  *@description Label for credential field that represents the Relying Party ID that the credential is scoped to.\n  */\n  rpId: 'RP ID',\n  /**\n  *@description Label for a column in a table. A field/unique ID that represents the user a credential is mapped to.\n  */\n  userHandle: 'User Handle',\n  /**\n  *@description Label for signature counter field for credentials which represents the number of successful assertions.\n  * See https://w3c.github.io/webauthn/#signature-counter.\n  */\n  signCount: 'Signature Count',\n  /**\n  *@description Label for column with actions for credentials.\n  */\n  actions: 'Actions',\n  /**\n  *@description Title for the table that holds the credentials that a authenticator has registered.\n  */\n  credentials: 'Credentials',\n  /**\n  *@description Label for the learn more link that is shown before the virtual environment is enabled.\n  */\n  useWebauthnForPhishingresistant: 'Use WebAuthn for phishing-resistant authentication',\n  /**\n  *@description Text that is usually a hyperlink to more documentation\n  */\n  learnMore: 'Learn more',\n  /**\n  *@description Title for section of interface that allows user to add a new virtual authenticator.\n  */\n  newAuthenticator: 'New authenticator',\n  /**\n  *@description Text for security or network protocol\n  */\n  protocol: 'Protocol',\n  /**\n  *@description Label for input to select which transport option to use on virtual authenticators, e.g. USB or Bluetooth.\n  */\n  transport: 'Transport',\n  /**\n  *@description Label for checkbox that toggles resident key support on virtual authenticators.\n  */\n  supportsResidentKeys: 'Supports resident keys',\n  /**\n  *@description Text to add something\n  */\n  add: 'Add',\n  /**\n  *@description Label for button to add a new virtual authenticator.\n  */\n  addAuthenticator: 'Add authenticator',\n  /**\n  *@description Label for radio button that toggles whether an authenticator is active.\n  */\n  active: 'Active',\n  /**\n  *@description Title for button that enables user to customize name of authenticator.\n  */\n  editName: 'Edit name',\n  /**\n  *@description Title for button that enables user to save name of authenticator after editing it.\n  */\n  saveName: 'Save name',\n  /**\n  *@description Title for a user-added virtual authenticator which is uniquely identified with its AUTHENTICATORID.\n  *@example {8c7873be-0b13-4996-a794-1521331bbd96} PH1\n  */\n  authenticatorS: 'Authenticator {PH1}',\n  /**\n  *@description Name for generated file which user can download. A private key is a secret code which enables encoding and decoding of a credential. .pem is the file extension.\n  */\n  privateKeypem: 'Private key.pem',\n  /**\n  *@description Label for field that holds an authenticator's universally unique identifier (UUID).\n  */\n  uuid: 'UUID',\n  /**\n  *@description Label for checkbox that toggles user verification support on virtual authenticators.\n  */\n  supportsUserVerification: 'Supports user verification',\n  /**\n  *@description Text in Timeline indicating that input has happened recently\n  */\n  yes: 'Yes',\n  /**\n  *@description Text in Timeline indicating that input has not happened recently\n  */\n  no: 'No',\n  /**\n  *@description Title of radio button that sets an authenticator as active.\n  *@example {Authenticator ABCDEF} PH1\n  */\n  setSAsTheActiveAuthenticator: 'Set {PH1} as the active authenticator',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/webauthn/WebauthnPane.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst TIMEOUT = 1000;\n\nconst enum Events {\n  ExportCredential = 'ExportCredential',\n  RemoveCredential = 'RemoveCredential',\n}\n\nclass DataGridNode extends DataGrid.DataGrid.DataGridNode<DataGridNode> {\n  constructor(credential: Protocol.WebAuthn.Credential) {\n    super(credential);\n  }\n\n  nodeSelfHeight(): number {\n    return 24;\n  }\n\n  createCell(columnId: string): HTMLElement {\n    const cell = super.createCell(columnId);\n    UI.Tooltip.Tooltip.install(cell, cell.textContent || '');\n\n    if (columnId !== 'actions') {\n      return cell;\n    }\n\n    const exportButton = UI.UIUtils.createTextButton(i18nString(UIStrings.export), (): void => {\n      if (this.dataGrid) {\n        this.dataGrid.dispatchEventToListeners(Events.ExportCredential, this.data);\n      }\n    });\n\n    cell.appendChild(exportButton);\n\n    const removeButton = UI.UIUtils.createTextButton(i18nString(UIStrings.remove), (): void => {\n      if (this.dataGrid) {\n        this.dataGrid.dispatchEventToListeners(Events.RemoveCredential, this.data);\n      }\n    });\n\n    cell.appendChild(removeButton);\n\n    return cell;\n  }\n}\n\nclass EmptyDataGridNode extends DataGrid.DataGrid.DataGridNode<DataGridNode> {\n  createCells(element: Element): void {\n    element.removeChildren();\n    const td = (this.createTDWithClass(DataGrid.DataGrid.Align.Center) as HTMLTableCellElement);\n    if (this.dataGrid) {\n      td.colSpan = this.dataGrid.visibleColumnsArray.length;\n    }\n\n    const code = document.createElement('span', {is: 'source-code'});\n    code.textContent = 'navigator.credentials.create()';\n    code.classList.add('code');\n    const message = i18n.i18n.getFormatLocalizedString(str_, UIStrings.noCredentialsTryCallingSFromYour, {PH1: code});\n\n    td.appendChild(message);\n    element.appendChild(td);\n  }\n}\n\ntype AvailableAuthenticatorOptions = Protocol.WebAuthn.VirtualAuthenticatorOptions&{\n  active: boolean,\n  authenticatorId: Protocol.WebAuthn.AuthenticatorId,\n};\n\nlet webauthnPaneImplInstance: WebauthnPaneImpl;\n\n// We extrapolate this variable as otherwise git detects a private key, even though we\n// perform string manipulation. If we extract the name, then the regex doesn't match\n// and we can upload as expected.\nconst PRIVATE_NAME = 'PRIVATE';\nconst PRIVATE_KEY_HEADER = `-----BEGIN ${PRIVATE_NAME} KEY-----\n`;\nconst PRIVATE_KEY_FOOTER = `-----END ${PRIVATE_NAME} KEY-----`;\n\nconst PROTOCOL_AUTHENTICATOR_VALUES: Protocol.EnumerableEnum<typeof Protocol.WebAuthn.AuthenticatorProtocol> = {\n  Ctap2: Protocol.WebAuthn.AuthenticatorProtocol.Ctap2,\n  U2f: Protocol.WebAuthn.AuthenticatorProtocol.U2f,\n};\n\nexport class WebauthnPaneImpl extends UI.Widget.VBox {\n  private enabled: boolean;\n  private activeAuthId: Protocol.WebAuthn.AuthenticatorId|null;\n  private hasBeenEnabled: boolean;\n  private readonly dataGrids: Map<Protocol.WebAuthn.AuthenticatorId, DataGrid.DataGrid.DataGridImpl<DataGridNode>>;\n  // @ts-ignore\n  private enableCheckbox: UI.Toolbar.ToolbarCheckbox;\n  private readonly availableAuthenticatorSetting: Common.Settings.Setting<AvailableAuthenticatorOptions[]>;\n  private model: SDK.WebAuthnModel.WebAuthnModel|null|undefined;\n  private authenticatorsView: HTMLElement;\n  private topToolbarContainer: HTMLElement|undefined;\n  private topToolbar: UI.Toolbar.Toolbar|undefined;\n  private learnMoreView: HTMLElement|undefined;\n  private newAuthenticatorSection: HTMLElement|undefined;\n  private newAuthenticatorForm: HTMLElement|undefined;\n  private protocolSelect: HTMLSelectElement|undefined;\n  private transportSelect: HTMLSelectElement|undefined;\n  private residentKeyCheckboxLabel: UI.UIUtils.CheckboxLabel|undefined;\n  private residentKeyCheckbox: HTMLInputElement|undefined;\n  private userVerificationCheckboxLabel: UI.UIUtils.CheckboxLabel|undefined;\n  private userVerificationCheckbox: HTMLInputElement|undefined;\n  private addAuthenticatorButton: HTMLButtonElement|undefined;\n  private isEnabling?: Promise<void>;\n\n  constructor() {\n    super(true);\n\n    this.contentElement.classList.add('webauthn-pane');\n    this.enabled = false;\n    this.activeAuthId = null;\n    this.hasBeenEnabled = false;\n    this.dataGrids = new Map();\n\n    this.availableAuthenticatorSetting =\n        (Common.Settings.Settings.instance().createSetting('webauthnAuthenticators', []) as\n         Common.Settings.Setting<AvailableAuthenticatorOptions[]>);\n\n    const mainTarget = SDK.TargetManager.TargetManager.instance().mainTarget();\n    if (mainTarget) {\n      this.model = mainTarget.model(SDK.WebAuthnModel.WebAuthnModel);\n    }\n\n    this.createToolbar();\n    this.authenticatorsView = this.contentElement.createChild('div', 'authenticators-view');\n    this.createNewAuthenticatorSection();\n    this.updateVisibility(false);\n  }\n\n  static instance(opts = {forceNew: null}): WebauthnPaneImpl {\n    const {forceNew} = opts;\n    if (!webauthnPaneImplInstance || forceNew) {\n      webauthnPaneImplInstance = new WebauthnPaneImpl();\n    }\n\n    return webauthnPaneImplInstance;\n  }\n\n  private async loadInitialAuthenticators(): Promise<void> {\n    let activeAuthenticatorId: Protocol.WebAuthn.AuthenticatorId|null = null;\n    const availableAuthenticators = this.availableAuthenticatorSetting.get();\n    for (const options of availableAuthenticators) {\n      if (!this.model) {\n        continue;\n      }\n\n      const authenticatorId = await this.model.addAuthenticator(options);\n      this.addAuthenticatorSection(authenticatorId, options);\n      // Update the authenticatorIds in the options.\n      options.authenticatorId = authenticatorId;\n      if (options.active) {\n        activeAuthenticatorId = authenticatorId;\n      }\n    }\n\n    // Update the settings to reflect the new authenticatorIds.\n    this.availableAuthenticatorSetting.set(availableAuthenticators);\n    if (activeAuthenticatorId) {\n      this.setActiveAuthenticator(activeAuthenticatorId);\n    }\n  }\n\n  async ownerViewDisposed(): Promise<void> {\n    if (this.enableCheckbox) {\n      this.enableCheckbox.setChecked(false);\n    }\n    await this.setVirtualAuthEnvEnabled(false);\n  }\n\n  private createToolbar(): void {\n    this.topToolbarContainer = this.contentElement.createChild('div', 'webauthn-toolbar-container');\n    this.topToolbar = new UI.Toolbar.Toolbar('webauthn-toolbar', this.topToolbarContainer);\n    const enableCheckboxTitle = i18nString(UIStrings.enableVirtualAuthenticator);\n    this.enableCheckbox =\n        new UI.Toolbar.ToolbarCheckbox(enableCheckboxTitle, enableCheckboxTitle, this.handleCheckboxToggle.bind(this));\n    this.topToolbar.appendToolbarItem(this.enableCheckbox);\n  }\n\n  private createCredentialsDataGrid(authenticatorId: Protocol.WebAuthn.AuthenticatorId):\n      DataGrid.DataGrid.DataGridImpl<DataGridNode> {\n    const columns = ([\n      {\n        id: 'credentialId',\n        title: i18nString(UIStrings.id),\n        longText: true,\n        weight: 24,\n      },\n      {\n        id: 'isResidentCredential',\n        title: i18nString(UIStrings.isResident),\n        dataType: DataGrid.DataGrid.DataType.Boolean,\n        weight: 10,\n      },\n      {\n        id: 'rpId',\n        title: i18nString(UIStrings.rpId),\n      },\n      {\n        id: 'userHandle',\n        title: i18nString(UIStrings.userHandle),\n      },\n      {\n        id: 'signCount',\n        title: i18nString(UIStrings.signCount),\n      },\n      {id: 'actions', title: i18nString(UIStrings.actions)},\n    ] as DataGrid.DataGrid.ColumnDescriptor[]);\n\n    const dataGridConfig = {\n      displayName: i18nString(UIStrings.credentials),\n      columns,\n      editCallback: undefined,\n      deleteCallback: undefined,\n      refreshCallback: undefined,\n    };\n    const dataGrid = new DataGrid.DataGrid.DataGridImpl(dataGridConfig);\n    dataGrid.renderInline();\n    dataGrid.setStriped(true);\n    dataGrid.addEventListener(Events.ExportCredential, this.handleExportCredential, this);\n    dataGrid.addEventListener(Events.RemoveCredential, this.handleRemoveCredential.bind(this, authenticatorId));\n\n    this.dataGrids.set(authenticatorId, dataGrid);\n\n    return dataGrid;\n  }\n\n  private handleExportCredential(e: {data: Protocol.WebAuthn.Credential}): void {\n    this.exportCredential(e.data);\n  }\n\n  private handleRemoveCredential(authenticatorId: Protocol.WebAuthn.AuthenticatorId, e: {\n    data: Protocol.WebAuthn.Credential,\n  }): void {\n    this.removeCredential(authenticatorId, e.data.credentialId);\n  }\n\n  private async updateCredentials(authenticatorId: Protocol.WebAuthn.AuthenticatorId): Promise<void> {\n    const dataGrid = this.dataGrids.get(authenticatorId);\n    if (!dataGrid) {\n      return;\n    }\n\n    if (this.model) {\n      const credentials = await this.model.getCredentials(authenticatorId);\n\n      dataGrid.rootNode().removeChildren();\n      for (const credential of credentials) {\n        const node = new DataGridNode(credential);\n        dataGrid.rootNode().appendChild(node);\n      }\n\n      this.maybeAddEmptyNode(dataGrid);\n    }\n\n    // TODO(crbug.com/1112528): Add back-end events for credential creation and removal to avoid polling.\n    setTimeout(this.updateCredentials.bind(this, authenticatorId), TIMEOUT);\n  }\n\n  private maybeAddEmptyNode(dataGrid: DataGrid.DataGrid.DataGridImpl<DataGridNode>): void {\n    if (dataGrid.rootNode().children.length) {\n      return;\n    }\n\n    const node = new EmptyDataGridNode();\n    dataGrid.rootNode().appendChild(node);\n  }\n\n  private async setVirtualAuthEnvEnabled(enable: boolean): Promise<void> {\n    await this.isEnabling;\n    this.isEnabling = new Promise<void>(async (resolve: (value: void) => void) => {\n      if (enable && !this.hasBeenEnabled) {\n        // Ensures metric is only tracked once per session.\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.VirtualAuthenticatorEnvironmentEnabled);\n        this.hasBeenEnabled = true;\n      }\n      this.enabled = enable;\n      if (this.model) {\n        await this.model.setVirtualAuthEnvEnabled(enable);\n      }\n\n      if (enable) {\n        await this.loadInitialAuthenticators();\n      } else {\n        this.removeAuthenticatorSections();\n      }\n\n      this.updateVisibility(enable);\n      this.isEnabling = undefined;\n      resolve();\n    });\n  }\n\n  private updateVisibility(enabled: boolean): void {\n    this.contentElement.classList.toggle('enabled', enabled);\n  }\n\n  private removeAuthenticatorSections(): void {\n    this.authenticatorsView.innerHTML = '';\n    this.dataGrids.clear();\n  }\n\n  private handleCheckboxToggle(e: MouseEvent): void {\n    this.setVirtualAuthEnvEnabled((e.target as HTMLInputElement).checked);\n  }\n\n  private updateEnabledTransportOptions(enabledOptions: Protocol.WebAuthn.AuthenticatorTransport[]): void {\n    if (!this.transportSelect) {\n      return;\n    }\n\n    const prevValue = this.transportSelect.value;\n    this.transportSelect.removeChildren();\n\n    for (const option of enabledOptions) {\n      this.transportSelect.appendChild(new Option(option, option));\n    }\n\n    // Make sure the currently selected value stays the same.\n    this.transportSelect.value = prevValue;\n    // If the new set does not include the previous value.\n    if (!this.transportSelect.value) {\n      // Select the first available value.\n      this.transportSelect.selectedIndex = 0;\n    }\n  }\n\n  private updateNewAuthenticatorSectionOptions(): void {\n    if (!this.protocolSelect || !this.residentKeyCheckbox || !this.userVerificationCheckbox) {\n      return;\n    }\n\n    if (this.protocolSelect.value === Protocol.WebAuthn.AuthenticatorProtocol.Ctap2) {\n      this.residentKeyCheckbox.disabled = false;\n      this.userVerificationCheckbox.disabled = false;\n      this.updateEnabledTransportOptions([\n        Protocol.WebAuthn.AuthenticatorTransport.Usb,\n        Protocol.WebAuthn.AuthenticatorTransport.Ble,\n        Protocol.WebAuthn.AuthenticatorTransport.Nfc,\n        // TODO (crbug.com/1034663): Toggle cable as option depending on if cablev2 flag is on.\n        // Protocol.WebAuthn.AuthenticatorTransport.Cable,\n        Protocol.WebAuthn.AuthenticatorTransport.Internal,\n      ]);\n    } else {\n      this.residentKeyCheckbox.checked = false;\n      this.residentKeyCheckbox.disabled = true;\n      this.userVerificationCheckbox.checked = false;\n      this.userVerificationCheckbox.disabled = true;\n      this.updateEnabledTransportOptions([\n        Protocol.WebAuthn.AuthenticatorTransport.Usb,\n        Protocol.WebAuthn.AuthenticatorTransport.Ble,\n        Protocol.WebAuthn.AuthenticatorTransport.Nfc,\n      ]);\n    }\n  }\n\n  private createNewAuthenticatorSection(): void {\n    this.learnMoreView = this.contentElement.createChild('div', 'learn-more');\n    this.learnMoreView.appendChild(UI.Fragment.html`\n  <div>\n  ${i18nString(UIStrings.useWebauthnForPhishingresistant)}<br /><br />\n  ${\n        UI.XLink.XLink.create(\n            'https://developers.google.com/web/updates/2018/05/webauthn', i18nString(UIStrings.learnMore))}\n  </div>\n  `);\n\n    this.newAuthenticatorSection = this.contentElement.createChild('div', 'new-authenticator-container');\n    const newAuthenticatorTitle =\n        UI.UIUtils.createLabel(i18nString(UIStrings.newAuthenticator), 'new-authenticator-title');\n    this.newAuthenticatorSection.appendChild(newAuthenticatorTitle);\n    this.newAuthenticatorForm = this.newAuthenticatorSection.createChild('div', 'new-authenticator-form');\n\n    const protocolGroup = this.newAuthenticatorForm.createChild('div', 'authenticator-option');\n    const transportGroup = this.newAuthenticatorForm.createChild('div', 'authenticator-option');\n    const residentKeyGroup = this.newAuthenticatorForm.createChild('div', 'authenticator-option');\n    const userVerificationGroup = this.newAuthenticatorForm.createChild('div', 'authenticator-option');\n    const addButtonGroup = this.newAuthenticatorForm.createChild('div', 'authenticator-option');\n\n    const protocolSelectTitle = UI.UIUtils.createLabel(i18nString(UIStrings.protocol), 'authenticator-option-label');\n    protocolGroup.appendChild(protocolSelectTitle);\n    this.protocolSelect = (protocolGroup.createChild('select', 'chrome-select') as HTMLSelectElement);\n    UI.ARIAUtils.bindLabelToControl(protocolSelectTitle, (this.protocolSelect as Element));\n    Object.values(PROTOCOL_AUTHENTICATOR_VALUES)\n        .sort()\n        .forEach((option: Protocol.WebAuthn.AuthenticatorProtocol): void => {\n          if (this.protocolSelect) {\n            this.protocolSelect.appendChild(new Option(option, option));\n          }\n        });\n\n    if (this.protocolSelect) {\n      this.protocolSelect.value = Protocol.WebAuthn.AuthenticatorProtocol.Ctap2;\n    }\n\n    const transportSelectTitle = UI.UIUtils.createLabel(i18nString(UIStrings.transport), 'authenticator-option-label');\n    transportGroup.appendChild(transportSelectTitle);\n    this.transportSelect = (transportGroup.createChild('select', 'chrome-select') as HTMLSelectElement);\n    UI.ARIAUtils.bindLabelToControl(transportSelectTitle, (this.transportSelect as Element));\n    // transportSelect will be populated in updateNewAuthenticatorSectionOptions.\n\n    this.residentKeyCheckboxLabel = UI.UIUtils.CheckboxLabel.create(i18nString(UIStrings.supportsResidentKeys), false);\n    this.residentKeyCheckboxLabel.textElement.classList.add('authenticator-option-label');\n    residentKeyGroup.appendChild(this.residentKeyCheckboxLabel.textElement);\n    this.residentKeyCheckbox = this.residentKeyCheckboxLabel.checkboxElement;\n    this.residentKeyCheckbox.checked = false;\n    this.residentKeyCheckbox.classList.add('authenticator-option-checkbox');\n    residentKeyGroup.appendChild(this.residentKeyCheckboxLabel);\n\n    this.userVerificationCheckboxLabel = UI.UIUtils.CheckboxLabel.create('Supports user verification', false);\n    this.userVerificationCheckboxLabel.textElement.classList.add('authenticator-option-label');\n    userVerificationGroup.appendChild(this.userVerificationCheckboxLabel.textElement);\n    this.userVerificationCheckbox = this.userVerificationCheckboxLabel.checkboxElement;\n    this.userVerificationCheckbox.checked = false;\n    this.userVerificationCheckbox.classList.add('authenticator-option-checkbox');\n    userVerificationGroup.appendChild(this.userVerificationCheckboxLabel);\n\n    this.addAuthenticatorButton =\n        UI.UIUtils.createTextButton(i18nString(UIStrings.add), this.handleAddAuthenticatorButton.bind(this), '');\n    addButtonGroup.createChild('div', 'authenticator-option-label');\n    addButtonGroup.appendChild(this.addAuthenticatorButton);\n    const addAuthenticatorTitle = UI.UIUtils.createLabel(i18nString(UIStrings.addAuthenticator), '');\n    UI.ARIAUtils.bindLabelToControl(addAuthenticatorTitle, this.addAuthenticatorButton);\n\n    this.updateNewAuthenticatorSectionOptions();\n    if (this.protocolSelect) {\n      this.protocolSelect.addEventListener('change', this.updateNewAuthenticatorSectionOptions.bind(this));\n    }\n  }\n\n  private async handleAddAuthenticatorButton(): Promise<void> {\n    const options = this.createOptionsFromCurrentInputs();\n    if (this.model) {\n      const authenticatorId = await this.model.addAuthenticator(options);\n      const availableAuthenticators = this.availableAuthenticatorSetting.get();\n      availableAuthenticators.push({authenticatorId, active: true, ...options});\n      this.availableAuthenticatorSetting.set(\n          availableAuthenticators.map(a => ({...a, active: a.authenticatorId === authenticatorId})));\n      const section = await this.addAuthenticatorSection(authenticatorId, options);\n      const mediaQueryList = window.matchMedia('(prefers-reduced-motion: reduce)');\n      const prefersReducedMotion = mediaQueryList.matches;\n      section.scrollIntoView({block: 'start', behavior: prefersReducedMotion ? 'auto' : 'smooth'});\n    }\n  }\n\n  private async addAuthenticatorSection(\n      authenticatorId: Protocol.WebAuthn.AuthenticatorId,\n      options: Protocol.WebAuthn.VirtualAuthenticatorOptions): Promise<HTMLDivElement> {\n    const section = document.createElement('div');\n    section.classList.add('authenticator-section');\n    section.setAttribute('data-authenticator-id', authenticatorId);\n    this.authenticatorsView.appendChild(section);\n\n    const headerElement = section.createChild('div', 'authenticator-section-header');\n    const titleElement = headerElement.createChild('div', 'authenticator-section-title');\n    UI.ARIAUtils.markAsHeading(titleElement, 2);\n\n    await this.clearActiveAuthenticator();\n    const activeButtonContainer = headerElement.createChild('div', 'active-button-container');\n    const activeLabel =\n        UI.UIUtils.createRadioLabel(`active-authenticator-${authenticatorId}`, i18nString(UIStrings.active));\n    activeLabel.radioElement.addEventListener('click', this.setActiveAuthenticator.bind(this, authenticatorId));\n    activeButtonContainer.appendChild(activeLabel);\n    /** @type {!HTMLInputElement} */ (activeLabel.radioElement as HTMLInputElement).checked = true;\n    this.activeAuthId = authenticatorId;  // Newly added authenticator is automatically set as active.\n\n    const removeButton = headerElement.createChild('button', 'text-button');\n    removeButton.textContent = i18nString(UIStrings.remove);\n    removeButton.addEventListener('click', this.removeAuthenticator.bind(this, authenticatorId));\n\n    const toolbar = new UI.Toolbar.Toolbar('edit-name-toolbar', titleElement);\n    const editName = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.editName), 'largeicon-edit');\n    const saveName = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.saveName), 'largeicon-checkmark');\n    saveName.setVisible(false);\n\n    const nameField = (titleElement.createChild('input', 'authenticator-name-field') as HTMLInputElement);\n    nameField.disabled = true;\n    const userFriendlyName = authenticatorId.slice(-5);  // User friendly name defaults to last 5 chars of UUID.\n    nameField.value = i18nString(UIStrings.authenticatorS, {PH1: userFriendlyName});\n    this.updateActiveLabelTitle(activeLabel, nameField.value);\n\n    editName.addEventListener(\n        UI.Toolbar.ToolbarButton.Events.Click,\n        (): void => this.handleEditNameButton(titleElement, nameField, editName, saveName));\n    saveName.addEventListener(\n        UI.Toolbar.ToolbarButton.Events.Click,\n        (): void => this.handleSaveNameButton(titleElement, nameField, editName, saveName, activeLabel));\n\n    nameField.addEventListener(\n        'focusout', (): void => this.handleSaveNameButton(titleElement, nameField, editName, saveName, activeLabel));\n    nameField.addEventListener('keydown', (event: KeyboardEvent): void => {\n      if (event.key === 'Enter') {\n        this.handleSaveNameButton(titleElement, nameField, editName, saveName, activeLabel);\n      }\n    });\n\n    toolbar.appendToolbarItem(editName);\n    toolbar.appendToolbarItem(saveName);\n\n    this.createAuthenticatorFields(section, authenticatorId, options);\n\n    const label = document.createElement('div');\n    label.classList.add('credentials-title');\n    label.textContent = i18nString(UIStrings.credentials);\n    section.appendChild(label);\n\n    const dataGrid = this.createCredentialsDataGrid(authenticatorId);\n    dataGrid.asWidget().show(section);\n\n    this.updateCredentials(authenticatorId);\n\n    return section;\n  }\n\n  private exportCredential(credential: Protocol.WebAuthn.Credential): void {\n    let pem = PRIVATE_KEY_HEADER;\n    for (let i = 0; i < credential.privateKey.length; i += 64) {\n      pem += credential.privateKey.substring(i, i + 64) + '\\n';\n    }\n    pem += PRIVATE_KEY_FOOTER;\n\n    const link = document.createElement('a');\n    link.download = i18nString(UIStrings.privateKeypem);\n    link.href = 'data:application/x-pem-file,' + encodeURIComponent(pem);\n    link.click();\n  }\n\n  private async removeCredential(authenticatorId: Protocol.WebAuthn.AuthenticatorId, credentialId: string):\n      Promise<void> {\n    const dataGrid = this.dataGrids.get(authenticatorId);\n    if (!dataGrid) {\n      return;\n    }\n\n    // @ts-ignore dataGrid node type is indeterminate.\n    dataGrid.rootNode()\n        .children\n        .find((n: DataGrid.DataGrid.DataGridNode<DataGridNode>): boolean => n.data.credentialId === credentialId)\n        .remove();\n    this.maybeAddEmptyNode(dataGrid);\n\n    if (this.model) {\n      await this.model.removeCredential(authenticatorId, credentialId);\n    }\n  }\n\n  /**\n   * Creates the fields describing the authenticator in the front end.\n   */\n  private createAuthenticatorFields(\n      section: Element, authenticatorId: string, options: Protocol.WebAuthn.VirtualAuthenticatorOptions): void {\n    const sectionFields = section.createChild('div', 'authenticator-fields');\n    const uuidField = sectionFields.createChild('div', 'authenticator-field');\n    const protocolField = sectionFields.createChild('div', 'authenticator-field');\n    const transportField = sectionFields.createChild('div', 'authenticator-field');\n    const srkField = sectionFields.createChild('div', 'authenticator-field');\n    const suvField = sectionFields.createChild('div', 'authenticator-field');\n\n    uuidField.appendChild(UI.UIUtils.createLabel(i18nString(UIStrings.uuid), 'authenticator-option-label'));\n    protocolField.appendChild(UI.UIUtils.createLabel(i18nString(UIStrings.protocol), 'authenticator-option-label'));\n    transportField.appendChild(UI.UIUtils.createLabel(i18nString(UIStrings.transport), 'authenticator-option-label'));\n    srkField.appendChild(\n        UI.UIUtils.createLabel(i18nString(UIStrings.supportsResidentKeys), 'authenticator-option-label'));\n    suvField.appendChild(\n        UI.UIUtils.createLabel(i18nString(UIStrings.supportsUserVerification), 'authenticator-option-label'));\n\n    uuidField.createChild('div', 'authenticator-field-value').textContent = authenticatorId;\n    protocolField.createChild('div', 'authenticator-field-value').textContent = options.protocol;\n    transportField.createChild('div', 'authenticator-field-value').textContent = options.transport;\n    srkField.createChild('div', 'authenticator-field-value').textContent =\n        options.hasResidentKey ? i18nString(UIStrings.yes) : i18nString(UIStrings.no);\n    suvField.createChild('div', 'authenticator-field-value').textContent =\n        options.hasUserVerification ? i18nString(UIStrings.yes) : i18nString(UIStrings.no);\n  }\n\n  private handleEditNameButton(\n      titleElement: Element, nameField: HTMLInputElement, editName: UI.Toolbar.ToolbarButton,\n      saveName: UI.Toolbar.ToolbarButton): void {\n    nameField.disabled = false;\n    titleElement.classList.add('editing-name');\n    nameField.focus();\n    saveName.setVisible(true);\n    editName.setVisible(false);\n  }\n\n  private handleSaveNameButton(\n      titleElement: Element, nameField: HTMLInputElement, editName: UI.Toolbar.ToolbarItem,\n      saveName: UI.Toolbar.ToolbarItem, activeLabel: UI.UIUtils.DevToolsRadioButton): void {\n    nameField.disabled = true;\n    titleElement.classList.remove('editing-name');\n    editName.setVisible(true);\n    saveName.setVisible(false);\n    this.updateActiveLabelTitle(activeLabel, nameField.value);\n  }\n\n  private updateActiveLabelTitle(activeLabel: UI.UIUtils.DevToolsRadioButton, authenticatorName: string): void {\n    UI.Tooltip.Tooltip.install(\n        activeLabel.radioElement, i18nString(UIStrings.setSAsTheActiveAuthenticator, {PH1: authenticatorName}));\n  }\n\n  /**\n   * Removes both the authenticator and its respective UI element.\n   */\n  private removeAuthenticator(authenticatorId: Protocol.WebAuthn.AuthenticatorId): void {\n    if (this.authenticatorsView) {\n      const child = this.authenticatorsView.querySelector(`[data-authenticator-id=${CSS.escape(authenticatorId)}]`);\n      if (child) {\n        child.remove();\n      }\n    }\n    this.dataGrids.delete(authenticatorId);\n\n    if (this.model) {\n      this.model.removeAuthenticator(authenticatorId);\n    }\n\n    // Update available authenticator setting.\n    const prevAvailableAuthenticators = this.availableAuthenticatorSetting.get();\n    const newAvailableAuthenticators = prevAvailableAuthenticators.filter(a => a.authenticatorId !== authenticatorId);\n    this.availableAuthenticatorSetting.set(newAvailableAuthenticators);\n\n    if (this.activeAuthId === authenticatorId) {\n      const availableAuthenticatorIds = Array.from(this.dataGrids.keys());\n      if (availableAuthenticatorIds.length) {\n        this.setActiveAuthenticator(availableAuthenticatorIds[0]);\n      } else {\n        this.activeAuthId = null;\n      }\n    }\n  }\n\n  private createOptionsFromCurrentInputs(): Protocol.WebAuthn.VirtualAuthenticatorOptions {\n    // TODO(crbug.com/1034663): Add optionality for isUserVerified param.\n    if (!this.protocolSelect || !this.transportSelect || !this.residentKeyCheckbox || !this.userVerificationCheckbox) {\n      throw new Error('Unable to create options from current inputs');\n    }\n\n    /**\n     * @type {!Protocol.WebAuthn.VirtualAuthenticatorOptions}\n     */\n    const options = ({\n      protocol: this.protocolSelect.options[this.protocolSelect.selectedIndex].value,\n      transport: this.transportSelect.options[this.transportSelect.selectedIndex].value,\n      hasResidentKey: this.residentKeyCheckbox.checked,\n      hasUserVerification: this.userVerificationCheckbox.checked,\n      automaticPresenceSimulation: true,\n      isUserVerified: true,\n    } as Protocol.WebAuthn.VirtualAuthenticatorOptions);\n\n    return options;\n  }\n\n  /**\n   * Sets the given authenticator as active.\n   * Note that a newly added authenticator will automatically be set as active.\n   */\n  private async setActiveAuthenticator(authenticatorId: Protocol.WebAuthn.AuthenticatorId): Promise<void> {\n    await this.clearActiveAuthenticator();\n    if (this.model) {\n      await this.model.setAutomaticPresenceSimulation(authenticatorId, true);\n    }\n    this.activeAuthId = authenticatorId;\n\n    const prevAvailableAuthenticators = this.availableAuthenticatorSetting.get();\n    const newAvailableAuthenticators =\n        prevAvailableAuthenticators.map(a => ({...a, active: a.authenticatorId === authenticatorId}));\n    this.availableAuthenticatorSetting.set(newAvailableAuthenticators);\n\n    this.updateActiveButtons();\n  }\n\n  private updateActiveButtons(): void {\n    const authenticators = this.authenticatorsView.getElementsByClassName('authenticator-section');\n    Array.from(authenticators).forEach((authenticator: Element): void => {\n      const button = (authenticator.querySelector('input.dt-radio-button') as HTMLInputElement);\n      if (!button) {\n        return;\n      }\n      button.checked =\n          /** @type {!HTMLElement} */ (authenticator as HTMLElement).dataset.authenticatorId === this.activeAuthId;\n    });\n  }\n\n  private async clearActiveAuthenticator(): Promise<void> {\n    if (this.activeAuthId && this.model) {\n      await this.model.setAutomaticPresenceSimulation(this.activeAuthId, false);\n    }\n    this.activeAuthId = null;\n    this.updateActiveButtons();\n  }\n  wasShown(): void {\n    super.wasShown();\n    this.registerCSSFiles([webauthnPaneStyles]);\n  }\n}\n"]}