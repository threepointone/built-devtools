{"version":3,"file":"NetworkPersistenceManager.js","sourceRoot":"","sources":["../../../../../../front_end/models/persistence/NetworkPersistenceManager.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as Workspace from '../workspace/workspace.js';\n\nimport type {FileSystem} from './FileSystemWorkspaceBinding.js';\nimport {FileSystemWorkspaceBinding} from './FileSystemWorkspaceBinding.js';\nimport {PersistenceBinding, PersistenceImpl} from './PersistenceImpl.js';\n\nlet networkPersistenceManagerInstance: NetworkPersistenceManager|null;\n\nexport class NetworkPersistenceManager extends Common.ObjectWrapper.ObjectWrapper {\n  private bindings: WeakMap<Workspace.UISourceCode.UISourceCode, PersistenceBinding>;\n  private readonly originalResponseContentPromises: WeakMap<Workspace.UISourceCode.UISourceCode, Promise<string|null>>;\n  private savingForOverrides: WeakSet<Workspace.UISourceCode.UISourceCode>;\n  private readonly savingSymbol: symbol;\n  private enabledSetting: Common.Settings.Setting<boolean>;\n  private readonly workspace: Workspace.Workspace.WorkspaceImpl;\n  private readonly networkUISourceCodeForEncodedPath: Map<string, Workspace.UISourceCode.UISourceCode>;\n  private readonly interceptionHandlerBound:\n      (interceptedRequest: SDK.NetworkManager.InterceptedRequest) => Promise<void>;\n  private readonly updateInterceptionThrottler: Common.Throttler.Throttler;\n  private projectInternal: Workspace.Workspace.Project|null;\n  private readonly activeProject: Workspace.Workspace.Project|null;\n  private activeInternal: boolean;\n  private enabled: boolean;\n  private eventDescriptors: Common.EventTarget.EventDescriptor[];\n\n  private constructor(workspace: Workspace.Workspace.WorkspaceImpl) {\n    super();\n    this.bindings = new WeakMap();\n    this.originalResponseContentPromises = new WeakMap();\n    this.savingForOverrides = new WeakSet();\n    this.savingSymbol = Symbol('SavingForOverrides');\n\n    this.enabledSetting = Common.Settings.Settings.instance().moduleSetting('persistenceNetworkOverridesEnabled');\n    this.enabledSetting.addChangeListener(this.enabledChanged, this);\n\n    this.workspace = workspace;\n\n    this.networkUISourceCodeForEncodedPath = new Map();\n    this.interceptionHandlerBound = this.interceptionHandler.bind(this);\n    this.updateInterceptionThrottler = new Common.Throttler.Throttler(50);\n\n    this.projectInternal = null;\n    this.activeProject = null;\n\n    this.activeInternal = false;\n    this.enabled = false;\n\n    this.workspace.addEventListener(Workspace.Workspace.Events.ProjectAdded, event => {\n      this.onProjectAdded(event.data);\n    });\n    this.workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved, event => {\n      this.onProjectRemoved(event.data);\n    });\n\n    PersistenceImpl.instance().addNetworkInterceptor(this.canHandleNetworkUISourceCode.bind(this));\n\n    this.eventDescriptors = [];\n    this.enabledChanged();\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n    workspace: Workspace.Workspace.WorkspaceImpl|null,\n  } = {forceNew: null, workspace: null}): NetworkPersistenceManager {\n    const {forceNew, workspace} = opts;\n    if (!networkPersistenceManagerInstance || forceNew) {\n      if (!workspace) {\n        throw new Error('Missing workspace for NetworkPersistenceManager');\n      }\n      networkPersistenceManagerInstance = new NetworkPersistenceManager(workspace);\n    }\n\n    return networkPersistenceManagerInstance;\n  }\n\n  active(): boolean {\n    return this.activeInternal;\n  }\n\n  project(): Workspace.Workspace.Project|null {\n    return this.projectInternal;\n  }\n\n  originalContentForUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<string|null>|null {\n    const binding = this.bindings.get(uiSourceCode);\n    if (!binding) {\n      return null;\n    }\n    const fileSystemUISourceCode = binding.fileSystem;\n    return this.originalResponseContentPromises.get(fileSystemUISourceCode) || null;\n  }\n\n  private async enabledChanged(): Promise<void> {\n    if (this.enabled === this.enabledSetting.get()) {\n      return;\n    }\n    this.enabled = this.enabledSetting.get();\n    if (this.enabled) {\n      this.eventDescriptors = [\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.UISourceCodeRenamed,\n            event => {\n              this.uiSourceCodeRenamedListener(event);\n            }),\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.UISourceCodeAdded,\n            event => {\n              this.uiSourceCodeAdded(event);\n            }),\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.UISourceCodeRemoved,\n            event => {\n              this.uiSourceCodeRemovedListener(event);\n            }),\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.WorkingCopyCommitted,\n            event => this.onUISourceCodeWorkingCopyCommitted(event.data.uiSourceCode)),\n      ];\n      await this.updateActiveProject();\n    } else {\n      Common.EventTarget.removeEventListeners(this.eventDescriptors);\n      await this.updateActiveProject();\n    }\n  }\n\n  private async uiSourceCodeRenamedListener(\n      event: Common.EventTarget.EventTargetEvent<Workspace.Workspace.UISourceCodeRenamedEvent>): Promise<void> {\n    const uiSourceCode = event.data.uiSourceCode;\n    await this.onUISourceCodeRemoved(uiSourceCode);\n    await this.onUISourceCodeAdded(uiSourceCode);\n  }\n\n  private async uiSourceCodeRemovedListener(\n      event: Common.EventTarget.EventTargetEvent<Workspace.UISourceCode.UISourceCode>): Promise<void> {\n    await this.onUISourceCodeRemoved(event.data);\n  }\n\n  private async uiSourceCodeAdded(event: Common.EventTarget.EventTargetEvent<Workspace.UISourceCode.UISourceCode>):\n      Promise<void> {\n    await this.onUISourceCodeAdded(event.data);\n  }\n\n  private async updateActiveProject(): Promise<void> {\n    const wasActive = this.activeInternal;\n    this.activeInternal = Boolean(\n        this.enabledSetting.get() && SDK.TargetManager.TargetManager.instance().mainTarget() && this.projectInternal);\n    if (this.activeInternal === wasActive) {\n      return;\n    }\n\n    if (this.activeInternal && this.projectInternal) {\n      await Promise.all(\n          this.projectInternal.uiSourceCodes().map(uiSourceCode => this.filesystemUISourceCodeAdded(uiSourceCode)));\n\n      const networkProjects = this.workspace.projectsForType(Workspace.Workspace.projectTypes.Network);\n      for (const networkProject of networkProjects) {\n        await Promise.all(\n            networkProject.uiSourceCodes().map(uiSourceCode => this.networkUISourceCodeAdded(uiSourceCode)));\n      }\n    } else if (this.projectInternal) {\n      await Promise.all(\n          this.projectInternal.uiSourceCodes().map(uiSourceCode => this.filesystemUISourceCodeRemoved(uiSourceCode)));\n      this.networkUISourceCodeForEncodedPath.clear();\n    }\n    PersistenceImpl.instance().refreshAutomapping();\n  }\n\n  private encodedPathFromUrl(url: string): string {\n    if (!this.activeInternal || !this.projectInternal) {\n      return '';\n    }\n    let urlPath = Common.ParsedURL.ParsedURL.urlWithoutHash(url.replace(/^https?:\\/\\//, ''));\n    if (urlPath.endsWith('/') && urlPath.indexOf('?') === -1) {\n      urlPath = urlPath + 'index.html';\n    }\n    let encodedPathParts = encodeUrlPathToLocalPathParts(urlPath);\n    const projectPath = FileSystemWorkspaceBinding.fileSystemPath(this.projectInternal.id());\n    const encodedPath = encodedPathParts.join('/');\n    if (projectPath.length + encodedPath.length > 200) {\n      const domain = encodedPathParts[0];\n      const encodedFileName = encodedPathParts[encodedPathParts.length - 1];\n      const shortFileName = encodedFileName ? encodedFileName.substr(0, 10) + '-' : '';\n      const extension = Common.ParsedURL.ParsedURL.extractExtension(urlPath);\n      const extensionPart = extension ? '.' + extension.substr(0, 10) : '';\n      encodedPathParts = [\n        domain,\n        'longurls',\n        shortFileName + Platform.StringUtilities.hashCode(encodedPath).toString(16) + extensionPart,\n      ];\n    }\n    return encodedPathParts.join('/');\n\n    function encodeUrlPathToLocalPathParts(urlPath: string): string[] {\n      const encodedParts = [];\n      for (const pathPart of fileNamePartsFromUrlPath(urlPath)) {\n        if (!pathPart) {\n          continue;\n        }\n        // encodeURI() escapes all the unsafe filename characters except /:?*\n        let encodedName = encodeURI(pathPart).replace(/[\\/:\\?\\*]/g, match => '%' + match[0].charCodeAt(0).toString(16));\n        // Windows does not allow a small set of filenames.\n        if (RESERVED_FILENAMES.has(encodedName.toLowerCase())) {\n          encodedName = encodedName.split('').map(char => '%' + char.charCodeAt(0).toString(16)).join('');\n        }\n        // Windows does not allow the file to end in a space or dot (space should already be encoded).\n        const lastChar = encodedName.charAt(encodedName.length - 1);\n        if (lastChar === '.') {\n          encodedName = encodedName.substr(0, encodedName.length - 1) + '%2e';\n        }\n        encodedParts.push(encodedName);\n      }\n      return encodedParts;\n    }\n\n    function fileNamePartsFromUrlPath(urlPath: string): string[] {\n      urlPath = Common.ParsedURL.ParsedURL.urlWithoutHash(urlPath);\n      const queryIndex = urlPath.indexOf('?');\n      if (queryIndex === -1) {\n        return urlPath.split('/');\n      }\n      if (queryIndex === 0) {\n        return [urlPath];\n      }\n      const endSection = urlPath.substr(queryIndex);\n      const parts = urlPath.substr(0, urlPath.length - endSection.length).split('/');\n      parts[parts.length - 1] += endSection;\n      return parts;\n    }\n  }\n\n  private decodeLocalPathToUrlPath(path: string): string {\n    try {\n      return unescape(path);\n    } catch (e) {\n      console.error(e);\n    }\n    return path;\n  }\n\n  private async unbind(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    const binding = this.bindings.get(uiSourceCode);\n    if (binding) {\n      this.bindings.delete(binding.network);\n      this.bindings.delete(binding.fileSystem);\n      await PersistenceImpl.instance().removeBinding(binding);\n    }\n  }\n\n  private async bind(\n      networkUISourceCode: Workspace.UISourceCode.UISourceCode,\n      fileSystemUISourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (this.bindings.has(networkUISourceCode)) {\n      await this.unbind(networkUISourceCode);\n    }\n    if (this.bindings.has(fileSystemUISourceCode)) {\n      await this.unbind(fileSystemUISourceCode);\n    }\n    const binding = new PersistenceBinding(networkUISourceCode, fileSystemUISourceCode);\n    this.bindings.set(networkUISourceCode, binding);\n    this.bindings.set(fileSystemUISourceCode, binding);\n    await PersistenceImpl.instance().addBinding(binding);\n    const uiSourceCodeOfTruth =\n        this.savingForOverrides.has(networkUISourceCode) ? networkUISourceCode : fileSystemUISourceCode;\n    const [{content}, encoded] =\n        await Promise.all([uiSourceCodeOfTruth.requestContent(), uiSourceCodeOfTruth.contentEncoded()]);\n    PersistenceImpl.instance().syncContent(uiSourceCodeOfTruth, content || '', encoded);\n  }\n\n  private onUISourceCodeWorkingCopyCommitted(uiSourceCode: Workspace.UISourceCode.UISourceCode): void {\n    this.saveUISourceCodeForOverrides(uiSourceCode);\n  }\n\n  canSaveUISourceCodeForOverrides(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return this.activeInternal && uiSourceCode.project().type() === Workspace.Workspace.projectTypes.Network &&\n        !this.bindings.has(uiSourceCode) && !this.savingForOverrides.has(uiSourceCode);\n  }\n\n  async saveUISourceCodeForOverrides(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (!this.canSaveUISourceCodeForOverrides(uiSourceCode)) {\n      return;\n    }\n    this.savingForOverrides.add(uiSourceCode);\n    let encodedPath = this.encodedPathFromUrl(uiSourceCode.url());\n    const content = (await uiSourceCode.requestContent()).content || '';\n    const encoded = await uiSourceCode.contentEncoded();\n    const lastIndexOfSlash = encodedPath.lastIndexOf('/');\n    const encodedFileName = encodedPath.substr(lastIndexOfSlash + 1);\n    encodedPath = encodedPath.substr(0, lastIndexOfSlash);\n    if (this.projectInternal) {\n      await this.projectInternal.createFile(encodedPath, encodedFileName, content, encoded);\n    }\n    this.fileCreatedForTest(encodedPath, encodedFileName);\n    this.savingForOverrides.delete(uiSourceCode);\n  }\n\n  private fileCreatedForTest(_path: string, _fileName: string): void {\n  }\n\n  private patternForFileSystemUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): string {\n    const relativePathParts = FileSystemWorkspaceBinding.relativePath(uiSourceCode);\n    if (relativePathParts.length < 2) {\n      return '';\n    }\n    if (relativePathParts[1] === 'longurls' && relativePathParts.length !== 2) {\n      return 'http?://' + relativePathParts[0] + '/*';\n    }\n    return 'http?://' + this.decodeLocalPathToUrlPath(relativePathParts.join('/'));\n  }\n\n  private async onUISourceCodeAdded(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    await this.networkUISourceCodeAdded(uiSourceCode);\n    await this.filesystemUISourceCodeAdded(uiSourceCode);\n  }\n\n  private canHandleNetworkUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return this.activeInternal && !uiSourceCode.url().startsWith('snippet://');\n  }\n\n  private async networkUISourceCodeAdded(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (uiSourceCode.project().type() !== Workspace.Workspace.projectTypes.Network ||\n        !this.canHandleNetworkUISourceCode(uiSourceCode)) {\n      return;\n    }\n    const url = Common.ParsedURL.ParsedURL.urlWithoutHash(uiSourceCode.url());\n    this.networkUISourceCodeForEncodedPath.set(this.encodedPathFromUrl(url), uiSourceCode);\n\n    const project = this.projectInternal as FileSystem;\n    const fileSystemUISourceCode =\n        project.uiSourceCodeForURL(project.fileSystemPath() + '/' + this.encodedPathFromUrl(url));\n    if (fileSystemUISourceCode) {\n      await this.bind(uiSourceCode, fileSystemUISourceCode);\n    }\n  }\n\n  private async filesystemUISourceCodeAdded(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (!this.activeInternal || uiSourceCode.project() !== this.projectInternal) {\n      return;\n    }\n    this.updateInterceptionPatterns();\n\n    const relativePath = FileSystemWorkspaceBinding.relativePath(uiSourceCode);\n    const networkUISourceCode = this.networkUISourceCodeForEncodedPath.get(relativePath.join('/'));\n    if (networkUISourceCode) {\n      await this.bind(networkUISourceCode, uiSourceCode);\n    }\n  }\n\n  private updateInterceptionPatterns(): void {\n    this.updateInterceptionThrottler.schedule(innerUpdateInterceptionPatterns.bind(this));\n\n    function innerUpdateInterceptionPatterns(this: NetworkPersistenceManager): Promise<void> {\n      if (!this.activeInternal || !this.projectInternal) {\n        return SDK.NetworkManager.MultitargetNetworkManager.instance().setInterceptionHandlerForPatterns(\n            [], this.interceptionHandlerBound);\n      }\n      const patterns = new Set<string>();\n      const indexFileName = 'index.html';\n      for (const uiSourceCode of this.projectInternal.uiSourceCodes()) {\n        const pattern = this.patternForFileSystemUISourceCode(uiSourceCode);\n        patterns.add(pattern);\n        if (pattern.endsWith('/' + indexFileName)) {\n          patterns.add(pattern.substr(0, pattern.length - indexFileName.length));\n        }\n      }\n\n      return SDK.NetworkManager.MultitargetNetworkManager.instance().setInterceptionHandlerForPatterns(\n          Array.from(patterns).map(\n              pattern =>\n                  ({urlPattern: pattern, interceptionStage: Protocol.Network.InterceptionStage.HeadersReceived})),\n          this.interceptionHandlerBound);\n    }\n  }\n\n  private async onUISourceCodeRemoved(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    await this.networkUISourceCodeRemoved(uiSourceCode);\n    await this.filesystemUISourceCodeRemoved(uiSourceCode);\n  }\n\n  private async networkUISourceCodeRemoved(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (uiSourceCode.project().type() === Workspace.Workspace.projectTypes.Network) {\n      await this.unbind(uiSourceCode);\n      this.networkUISourceCodeForEncodedPath.delete(this.encodedPathFromUrl(uiSourceCode.url()));\n    }\n  }\n\n  private async filesystemUISourceCodeRemoved(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (uiSourceCode.project() !== this.projectInternal) {\n      return;\n    }\n    this.updateInterceptionPatterns();\n    this.originalResponseContentPromises.delete(uiSourceCode);\n    await this.unbind(uiSourceCode);\n  }\n\n  private async setProject(project: Workspace.Workspace.Project|null): Promise<void> {\n    if (project === this.projectInternal) {\n      return;\n    }\n\n    if (this.projectInternal) {\n      await Promise.all(\n          this.projectInternal.uiSourceCodes().map(uiSourceCode => this.filesystemUISourceCodeRemoved(uiSourceCode)));\n    }\n\n    this.projectInternal = project;\n\n    if (this.projectInternal) {\n      await Promise.all(\n          this.projectInternal.uiSourceCodes().map(uiSourceCode => this.filesystemUISourceCodeAdded(uiSourceCode)));\n    }\n\n    await this.updateActiveProject();\n    this.dispatchEventToListeners(Events.ProjectChanged, this.projectInternal);\n  }\n\n  private async onProjectAdded(project: Workspace.Workspace.Project): Promise<void> {\n    if (project.type() !== Workspace.Workspace.projectTypes.FileSystem ||\n        FileSystemWorkspaceBinding.fileSystemType(project) !== 'overrides') {\n      return;\n    }\n    const fileSystemPath = FileSystemWorkspaceBinding.fileSystemPath(project.id());\n    if (!fileSystemPath) {\n      return;\n    }\n    if (this.projectInternal) {\n      this.projectInternal.remove();\n    }\n\n    await this.setProject(project);\n  }\n\n  private async onProjectRemoved(project: Workspace.Workspace.Project): Promise<void> {\n    if (project === this.projectInternal) {\n      await this.setProject(null);\n    }\n  }\n\n  private async interceptionHandler(interceptedRequest: SDK.NetworkManager.InterceptedRequest): Promise<void> {\n    const method = interceptedRequest.request.method;\n    if (!this.activeInternal || (method !== 'GET' && method !== 'POST')) {\n      return;\n    }\n    const proj = this.projectInternal as FileSystem;\n    const path = proj.fileSystemPath() + '/' + this.encodedPathFromUrl(interceptedRequest.request.url);\n    const fileSystemUISourceCode = proj.uiSourceCodeForURL(path);\n    if (!fileSystemUISourceCode) {\n      return;\n    }\n\n    let mimeType = '';\n    if (interceptedRequest.responseHeaders) {\n      const responseHeaders = SDK.NetworkManager.NetworkManager.lowercaseHeaders(interceptedRequest.responseHeaders);\n      mimeType = responseHeaders['content-type'];\n    }\n\n    if (!mimeType) {\n      const expectedResourceType =\n          Common.ResourceType.resourceTypes[interceptedRequest.resourceType] || Common.ResourceType.resourceTypes.Other;\n      mimeType = fileSystemUISourceCode.mimeType();\n      if (Common.ResourceType.ResourceType.fromMimeType(mimeType) !== expectedResourceType) {\n        mimeType = expectedResourceType.canonicalMimeType();\n      }\n    }\n    const project = fileSystemUISourceCode.project() as FileSystem;\n\n    this.originalResponseContentPromises.set(\n        fileSystemUISourceCode, interceptedRequest.responseBody().then(response => {\n          if (response.error || response.content === null) {\n            return null;\n          }\n          if (response.encoded) {\n            const text = atob(response.content);\n            const data = new Uint8Array(text.length);\n            for (let i = 0; i < text.length; ++i) {\n              data[i] = text.charCodeAt(i);\n            }\n            return new TextDecoder('utf-8').decode(data);\n          }\n          return response.content;\n        }));\n\n    const blob = await project.requestFileBlob(fileSystemUISourceCode);\n    if (blob) {\n      interceptedRequest.continueRequestWithContent(new Blob([blob], {type: mimeType}));\n    }\n  }\n}\n\nconst RESERVED_FILENAMES = new Set<string>([\n  'con',  'prn',  'aux',  'nul',  'com1', 'com2', 'com3', 'com4', 'com5', 'com6', 'com7',\n  'com8', 'com9', 'lpt1', 'lpt2', 'lpt3', 'lpt4', 'lpt5', 'lpt6', 'lpt7', 'lpt8', 'lpt9',\n]);\n\nexport const Events = {\n  ProjectChanged: Symbol('ProjectChanged'),\n};\n"]}