{"version":3,"file":"Resource.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/Resource.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Common from '../common/common.js';\nimport * as Platfrom from '../platform/platform.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport type {NetworkRequest} from './NetworkRequest.js';\nimport {Events} from './NetworkRequest.js';\nimport type {ResourceTreeFrame, ResourceTreeModel} from './ResourceTreeModel.js';\n\nexport class Resource implements TextUtils.ContentProvider.ContentProvider {\n  private readonly resourceTreeModel: ResourceTreeModel;\n  private requestInternal: NetworkRequest|null;\n  private urlInternal!: string;\n  private readonly documentURLInternal: string;\n  private readonly frameIdInternal: Protocol.Page.FrameId|null;\n  private readonly loaderIdInternal: Protocol.Network.LoaderId|null;\n  private readonly type: Common.ResourceType.ResourceType;\n  private mimeTypeInternal: string;\n  private isGeneratedInternal: boolean;\n  private lastModifiedInternal: Date|null;\n  private readonly contentSizeInternal: number|null;\n  private contentInternal!: string|null;\n  private contentLoadError!: string|null;\n  private contentEncodedInternal!: boolean;\n  private readonly pendingContentCallbacks: ((arg0: Object|null) => void)[];\n  private parsedURLInternal?: Common.ParsedURL.ParsedURL;\n  private contentRequested?: boolean;\n\n  constructor(\n      resourceTreeModel: ResourceTreeModel, request: NetworkRequest|null, url: string, documentURL: string,\n      frameId: Protocol.Page.FrameId|null, loaderId: Protocol.Network.LoaderId|null,\n      type: Common.ResourceType.ResourceType, mimeType: string, lastModified: Date|null, contentSize: number|null) {\n    this.resourceTreeModel = resourceTreeModel;\n    this.requestInternal = request;\n    this.url = url;\n\n    this.documentURLInternal = documentURL;\n    this.frameIdInternal = frameId;\n    this.loaderIdInternal = loaderId;\n    this.type = type || Common.ResourceType.resourceTypes.Other;\n    this.mimeTypeInternal = mimeType;\n    this.isGeneratedInternal = false;\n\n    this.lastModifiedInternal = lastModified && Platfrom.DateUtilities.isValid(lastModified) ? lastModified : null;\n    this.contentSizeInternal = contentSize;\n    this.pendingContentCallbacks = [];\n    if (this.requestInternal && !this.requestInternal.finished) {\n      this.requestInternal.addEventListener(Events.FinishedLoading, this.requestFinished, this);\n    }\n  }\n\n  lastModified(): Date|null {\n    if (this.lastModifiedInternal || !this.requestInternal) {\n      return this.lastModifiedInternal;\n    }\n    const lastModifiedHeader = this.requestInternal.responseLastModified();\n    const date = lastModifiedHeader ? new Date(lastModifiedHeader) : null;\n    this.lastModifiedInternal = date && Platfrom.DateUtilities.isValid(date) ? date : null;\n    return this.lastModifiedInternal;\n  }\n\n  contentSize(): number|null {\n    if (typeof this.contentSizeInternal === 'number' || !this.requestInternal) {\n      return this.contentSizeInternal;\n    }\n    return this.requestInternal.resourceSize;\n  }\n\n  get request(): NetworkRequest|null {\n    return this.requestInternal;\n  }\n\n  get url(): string {\n    return this.urlInternal;\n  }\n\n  set url(x: string) {\n    this.urlInternal = x;\n    this.parsedURLInternal = new Common.ParsedURL.ParsedURL(x);\n  }\n\n  get parsedURL(): Common.ParsedURL.ParsedURL|undefined {\n    return this.parsedURLInternal;\n  }\n\n  get documentURL(): string {\n    return this.documentURLInternal;\n  }\n\n  get frameId(): Protocol.Page.FrameId|null {\n    return this.frameIdInternal;\n  }\n\n  get loaderId(): Protocol.Network.LoaderId|null {\n    return this.loaderIdInternal;\n  }\n\n  get displayName(): string {\n    return this.parsedURLInternal ? this.parsedURLInternal.displayName : '';\n  }\n\n  resourceType(): Common.ResourceType.ResourceType {\n    return this.requestInternal ? this.requestInternal.resourceType() : this.type;\n  }\n\n  get mimeType(): string {\n    return this.requestInternal ? this.requestInternal.mimeType : this.mimeTypeInternal;\n  }\n\n  get content(): string|null {\n    return this.contentInternal;\n  }\n\n  get isGenerated(): boolean {\n    return this.isGeneratedInternal;\n  }\n\n  set isGenerated(val: boolean) {\n    this.isGeneratedInternal = val;\n  }\n\n  contentURL(): string {\n    return this.urlInternal;\n  }\n\n  contentType(): Common.ResourceType.ResourceType {\n    if (this.resourceType() === Common.ResourceType.resourceTypes.Document &&\n        this.mimeType.indexOf('javascript') !== -1) {\n      return Common.ResourceType.resourceTypes.Script;\n    }\n    return this.resourceType();\n  }\n\n  async contentEncoded(): Promise<boolean> {\n    await this.requestContent();\n    return this.contentEncodedInternal;\n  }\n\n  requestContent(): Promise<TextUtils.ContentProvider.DeferredContent> {\n    if (typeof this.contentInternal !== 'undefined') {\n      return Promise.resolve({content: (this.contentInternal as string), isEncoded: this.contentEncodedInternal});\n    }\n\n    return new Promise(resolve => {\n      this.pendingContentCallbacks.push((resolve as (arg0: Object|null) => void));\n      if (!this.requestInternal || this.requestInternal.finished) {\n        this.innerRequestContent();\n      }\n    });\n  }\n\n  canonicalMimeType(): string {\n    return this.contentType().canonicalMimeType() || this.mimeType;\n  }\n\n  async searchInContent(query: string, caseSensitive: boolean, isRegex: boolean):\n      Promise<TextUtils.ContentProvider.SearchMatch[]> {\n    if (!this.frameId) {\n      return [];\n    }\n    if (this.request) {\n      return this.request.searchInContent(query, caseSensitive, isRegex);\n    }\n    const result = await this.resourceTreeModel.target().pageAgent().invoke_searchInResource(\n        {frameId: this.frameId, url: this.url, query, caseSensitive, isRegex});\n    return result.result || [];\n  }\n\n  async populateImageSource(image: HTMLImageElement): Promise<void> {\n    const {content} = await this.requestContent();\n    const encoded = this.contentEncodedInternal;\n    image.src = TextUtils.ContentProvider.contentAsDataURL(content, this.mimeTypeInternal, encoded) || this.urlInternal;\n  }\n\n  private requestFinished(): void {\n    if (this.requestInternal) {\n      this.requestInternal.removeEventListener(Events.FinishedLoading, this.requestFinished, this);\n    }\n    if (this.pendingContentCallbacks.length) {\n      this.innerRequestContent();\n    }\n  }\n\n  private async innerRequestContent(): Promise<void> {\n    if (this.contentRequested) {\n      return;\n    }\n    this.contentRequested = true;\n\n    let loadResult: {\n      content: string,\n      isEncoded: boolean,\n    }|{\n      content: null,\n      error: string,\n      isEncoded: false,\n    }|{\n      content: string,\n      isEncoded: boolean,\n    }|null = null;\n    if (this.request) {\n      const contentData = await this.request.contentData();\n      if (!contentData.error) {\n        this.contentInternal = contentData.content;\n        this.contentEncodedInternal = contentData.encoded;\n        loadResult = {content: (contentData.content as string), isEncoded: contentData.encoded};\n      }\n    }\n    if (!loadResult) {\n      const response = await this.resourceTreeModel.target().pageAgent().invoke_getResourceContent(\n          {frameId: this.frameId as Protocol.Page.FrameId, url: this.url});\n      const protocolError = response.getError();\n      if (protocolError) {\n        this.contentLoadError = protocolError;\n        this.contentInternal = null;\n        loadResult = {content: null, error: protocolError, isEncoded: false};\n      } else {\n        this.contentInternal = response.content;\n        this.contentLoadError = null;\n        loadResult = {content: response.content, isEncoded: response.base64Encoded};\n      }\n      this.contentEncodedInternal = response.base64Encoded;\n    }\n\n    if (this.contentInternal === null) {\n      this.contentEncodedInternal = false;\n    }\n\n    for (const callback of this.pendingContentCallbacks.splice(0)) {\n      callback(loadResult);\n    }\n\n    delete this.contentRequested;\n  }\n\n  hasTextContent(): boolean {\n    if (this.type.isTextType()) {\n      return true;\n    }\n    if (this.type === Common.ResourceType.resourceTypes.Other) {\n      return Boolean(this.contentInternal) && !this.contentEncodedInternal;\n    }\n    return false;\n  }\n\n  frame(): ResourceTreeFrame|null {\n    return this.frameIdInternal ? this.resourceTreeModel.frameForId(this.frameIdInternal) : null;\n  }\n\n  statusCode(): number {\n    return this.requestInternal ? this.requestInternal.statusCode : 0;\n  }\n}\n"]}