{"version":3,"file":"SecurityOriginManager.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/SecurityOriginManager.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAG7B,OAAO,EAAC,UAAU,EAAC,MAAM,aAAa,CAAC;AACvC,OAAO,EAAC,QAAQ,EAAC,MAAM,eAAe,CAAC;AAEvC,MAAM,OAAO,qBAAsB,SAAQ,QAAoB;IACrD,0BAA0B,CAAS;IACnC,qCAAqC,CAAc;IACnD,uBAAuB,CAAc;IAC7C,YAAY,MAAc;QACxB,KAAK,CAAC,MAAM,CAAC,CAAC;QAEd,qEAAqE;QACrE,gFAAgF;QAChF,yEAAyE;QACzE,yEAAyE;QACzE,IAAI,CAAC,0BAA0B,GAAG,EAAE,CAAC;QACrC,IAAI,CAAC,qCAAqC,GAAG,EAAE,CAAC;QAEhD,IAAI,CAAC,uBAAuB,GAAG,IAAI,GAAG,EAAE,CAAC;IAC3C,CAAC;IAED,qBAAqB,CAAC,eAA4B;QAChD,MAAM,UAAU,GAAG,IAAI,CAAC,uBAAuB,CAAC;QAChD,IAAI,CAAC,uBAAuB,GAAG,eAAe,CAAC;QAE/C,KAAK,MAAM,MAAM,IAAI,UAAU,EAAE;YAC/B,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;gBAC7C,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,qBAAqB,EAAE,MAAM,CAAC,CAAC;aACrE;SACF;QAED,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,uBAAuB,EAAE;YACjD,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;gBAC3B,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAAC;aACnE;SACF;IACH,CAAC;IAED,eAAe;QACb,OAAO,CAAC,GAAG,IAAI,CAAC,uBAAuB,CAAC,CAAC;IAC3C,CAAC;IAED,kBAAkB;QAChB,OAAO,IAAI,CAAC,0BAA0B,CAAC;IACzC,CAAC;IAED,6BAA6B;QAC3B,OAAO,IAAI,CAAC,qCAAqC,CAAC;IACpD,CAAC;IAED,qBAAqB,CAAC,cAAsB,EAAE,yBAAiC;QAC7E,IAAI,CAAC,0BAA0B,GAAG,cAAc,CAAC;QACjD,IAAI,CAAC,qCAAqC,GAAG,yBAAyB,IAAI,IAAI,CAAC;QAC/E,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,yBAAyB,EAAE;YAC9D,kBAAkB,EAAE,IAAI,CAAC,0BAA0B;YACnD,6BAA6B,EAAE,IAAI,CAAC,qCAAqC;SAC1E,CAAC,CAAC;IACL,CAAC;CACF;AAED,wDAAwD;AACxD,+CAA+C;AAC/C,MAAM,CAAN,IAAY,MAIX;AAJD,WAAY,MAAM;IAChB,qDAA2C,CAAA;IAC3C,yDAA+C,CAAA;IAC/C,iEAAuD,CAAA;AACzD,CAAC,EAJW,MAAM,KAAN,MAAM,QAIjB;AAaD,kFAAkF;AAClF,QAAQ,CAAC,QAAQ,CAAC,qBAAqB,EAAE,EAAC,YAAY,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,EAAE,KAAK,EAAC,CAAC,CAAC","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type {Target} from './Target.js';\nimport {Capability} from './Target.js';\nimport {SDKModel} from './SDKModel.js';\n\nexport class SecurityOriginManager extends SDKModel<EventTypes> {\n  private mainSecurityOriginInternal: string;\n  private unreachableMainSecurityOriginInternal: string|null;\n  private securityOriginsInternal: Set<string>;\n  constructor(target: Target) {\n    super(target);\n\n    // if a URL is unreachable, the browser will jump to an error page at\n    // 'chrome-error://chromewebdata/', and |this.mainSecurityOriginInternal| stores\n    // its origin. In this situation, the original unreachable URL's security\n    // origin will be stored in |this.unreachableMainSecurityOriginInternal|.\n    this.mainSecurityOriginInternal = '';\n    this.unreachableMainSecurityOriginInternal = '';\n\n    this.securityOriginsInternal = new Set();\n  }\n\n  updateSecurityOrigins(securityOrigins: Set<string>): void {\n    const oldOrigins = this.securityOriginsInternal;\n    this.securityOriginsInternal = securityOrigins;\n\n    for (const origin of oldOrigins) {\n      if (!this.securityOriginsInternal.has(origin)) {\n        this.dispatchEventToListeners(Events.SecurityOriginRemoved, origin);\n      }\n    }\n\n    for (const origin of this.securityOriginsInternal) {\n      if (!oldOrigins.has(origin)) {\n        this.dispatchEventToListeners(Events.SecurityOriginAdded, origin);\n      }\n    }\n  }\n\n  securityOrigins(): string[] {\n    return [...this.securityOriginsInternal];\n  }\n\n  mainSecurityOrigin(): string {\n    return this.mainSecurityOriginInternal;\n  }\n\n  unreachableMainSecurityOrigin(): string|null {\n    return this.unreachableMainSecurityOriginInternal;\n  }\n\n  setMainSecurityOrigin(securityOrigin: string, unreachableSecurityOrigin: string): void {\n    this.mainSecurityOriginInternal = securityOrigin;\n    this.unreachableMainSecurityOriginInternal = unreachableSecurityOrigin || null;\n    this.dispatchEventToListeners(Events.MainSecurityOriginChanged, {\n      mainSecurityOrigin: this.mainSecurityOriginInternal,\n      unreachableMainSecurityOrigin: this.unreachableMainSecurityOriginInternal,\n    });\n  }\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  SecurityOriginAdded = 'SecurityOriginAdded',\n  SecurityOriginRemoved = 'SecurityOriginRemoved',\n  MainSecurityOriginChanged = 'MainSecurityOriginChanged',\n}\n\nexport interface MainSecurityOriginChangedEvent {\n  mainSecurityOrigin: string;\n  unreachableMainSecurityOrigin: string|null;\n}\n\nexport type EventTypes = {\n  [Events.SecurityOriginAdded]: string,\n  [Events.SecurityOriginRemoved]: string,\n  [Events.MainSecurityOriginChanged]: MainSecurityOriginChangedEvent,\n};\n\n// TODO(jarhar): this is the only usage of Capability.None. Do something about it!\nSDKModel.register(SecurityOriginManager, {capabilities: Capability.None, autostart: false});\n"]}